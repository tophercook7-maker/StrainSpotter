import{r as i,j as e,B as r,C as D,S as a,y as F,T as t,i as y,n as k,A as E,a2 as T,f as $,h as H,D as N,p as R,L as G,ai as U,q as O,u as V}from"./react-vendor-CxfKVgr3.js";import{s as q,a as m,C as _}from"./App-JmJcCWdD.js";import{E as Y}from"./EmptyStateCard-sMvJRayT.js";import{b as J}from"./router-vendor-C0qkbn0g.js";import"./vendor-DCH4KwNm.js";function se({onBack:x,onSelectScan:u}){const f=J(),[j,B]=i.useState([]),[c,b]=i.useState(!0),[l,w]=i.useState(null),[p,v]=i.useState(null),[n,d]=i.useState(null),[g,C]=i.useState(!1),S=i.useCallback(async()=>{try{b(!0);let s=null;try{s=(await q?.auth.getSession())?.data?.session?.user?.id||null}catch(I){console.debug("[ScanHistory] getSession failed",I)}const o=s?`${m}/api/scans?user_id=${encodeURIComponent(s)}`:`${m}/api/scans`,h=await fetch(o);if(!h.ok)throw new Error("Failed to fetch scans");const z=await h.json();B(z.scans||[]),w(null)}catch(s){w(s.message)}finally{b(!1)}},[]);i.useEffect(()=>{S()},[S]);const L=async s=>{if(u&&typeof u=="function"){u(s);return}if(s.matched_strain_slug){v(s),C(!0);try{const o=await fetch(`${m}/api/strains/${s.matched_strain_slug}`);if(o.ok){const h=await o.json();d(h)}else d(null)}catch(o){console.error("Failed to load strain details:",o),d(null)}finally{C(!1)}}},A=()=>{v(null),d(null)},W=typeof window<"u"&&(window.Capacitor||window.location.protocol==="capacitor:"||/iPhone|iPad|iPod|Android/i.test(window.navigator.userAgent))?"calc(env(safe-area-inset-top) + 20px)":"20px",P=()=>{x?x():f?f("/garden"):window.history.back()};return e.jsxs(r,{sx:{display:"flex",flexDirection:"column",height:"100vh",overflow:"hidden"},children:[e.jsx(r,{sx:{flexShrink:0,pt:W,px:2,pb:1,borderBottom:"1px solid rgba(255,255,255,0.08)",bgcolor:"transparent",backdropFilter:"blur(10px)",zIndex:1},children:e.jsx(D,{maxWidth:"md",children:e.jsxs(a,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(a,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(IconButton,{edge:"start",onClick:P,sx:{color:"#fff",mr:1},"aria-label":"Go back",children:e.jsx(F,{})}),e.jsx(_,{style:{height:28,color:"#7cb342"}}),e.jsx(t,{variant:"h5",fontWeight:700,sx:{color:"#fff"},children:"Scan History"})]}),e.jsx(a,{direction:"row",spacing:1,children:e.jsx(y,{variant:"contained",color:"success",startIcon:e.jsx(_,{style:{height:20}}),onClick:()=>f("/garden"),sx:{textTransform:"none"},children:"Garden"})})]})})}),e.jsx(r,{sx:{flex:1,minHeight:0,overflowY:"auto",WebkitOverflowScrolling:"touch"},children:e.jsxs(D,{maxWidth:"md",sx:{py:4},children:[c&&e.jsx(r,{sx:{display:"flex",justifyContent:"center",py:6},children:e.jsx(k,{})}),!c&&l&&e.jsx(E,{severity:"error",sx:{mb:3},children:l}),!c&&!l&&j.length===0&&e.jsx(Y,{title:"No scans yet",description:"Upload your first bud photo to see AI matches and build your history.",icon:e.jsx(T,{sx:{fontSize:56,color:"#7cb342"}}),actionLabel:"Start a scan",onAction:()=>window.dispatchEvent(new CustomEvent("nav:set-view",{detail:"scanner"})),secondaryActionLabel:"Back to home",onSecondaryAction:x}),!c&&!l&&j.length>0&&e.jsx(a,{spacing:2,children:j.map(s=>e.jsx($,{variant:"outlined",sx:{borderRadius:3,background:"rgba(255,255,255,0.08)"},children:e.jsxs(H,{children:[e.jsxs(a,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(r,{children:[e.jsx(t,{variant:"h6",fontWeight:600,children:s.matched_strain_name||"Unknown Strain"}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Scanned on ",new Date(s.created_at).toLocaleString()]})]}),e.jsx(a,{direction:"row",spacing:1,children:e.jsx(y,{size:"small",variant:"contained",color:"success",onClick:()=>L(s),disabled:!s.matched_strain_slug,children:"View Details"})})]}),s.notes&&e.jsx(t,{variant:"body2",sx:{mt:1},children:s.notes})]})},s.id))})]})}),e.jsxs(N,{open:!!p,onClose:A,maxWidth:"sm",fullWidth:!0,children:[e.jsx(R,{children:e.jsxs(a,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(a,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(G,{color:"success"}),e.jsx(t,{variant:"h6",fontWeight:600,children:"Strain Details"})]}),e.jsx(y,{onClick:A,size:"small",color:"inherit",startIcon:e.jsx(U,{fontSize:"small"}),children:"Close"})]})}),e.jsxs(O,{dividers:!0,children:[g&&e.jsx(r,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(k,{})}),!g&&n&&e.jsxs(a,{spacing:2,children:[e.jsx(t,{variant:"h6",children:n.name}),e.jsx(t,{variant:"body2",color:"text.secondary",children:n.description||"No description available."}),Array.isArray(n.effects)&&n.effects.length>0&&e.jsxs(r,{children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Effects"}),e.jsx(t,{variant:"body2",children:n.effects.join(", ")})]}),Array.isArray(n.flavors)&&n.flavors.length>0&&e.jsxs(r,{children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,children:"Flavors"}),e.jsx(t,{variant:"body2",children:n.flavors.join(", ")})]})]}),!g&&!n&&e.jsx(E,{severity:"info",children:"Strain details not available."})]}),p&&e.jsx(V,{children:e.jsxs(t,{variant:"caption",color:"text.secondary",sx:{px:2,pb:1},children:["Scan ID: ",p.id]})})]})]})}export{se as default};
