import{r as a,j as e,C,T as i,i as d,A as _,k as G,l as E,f as M,h as z,bd as L,be as P,bf as j,bg as t,bh as $,H as w,D as K,p as Q,q as V,S as X,m as f,u as Y}from"./react-vendor-CxfKVgr3.js";import{s as Z,a as b}from"./App-JmJcCWdD.js";import"./vendor-DCH4KwNm.js";function ae({onBack:h}){const[l,N]=a.useState(0),[g,q]=a.useState([]),[v,F]=a.useState([]),[y,k]=a.useState(!0),[o,T]=a.useState(null),[H,u]=a.useState(!1),[r,x]=a.useState({payment_received:!1,payment_amount:"",payment_reference:"",tier:"full",expires_at:""}),[c,R]=a.useState(null),[A,B]=a.useState(!1),[I,S]=a.useState(!1),[J,p]=a.useState(null);a.useEffect(()=>{O()},[]),a.useEffect(()=>{A&&c&&D()},[l,A,c]);const O=async()=>{try{const{data:{session:s}}=await Z.auth.getSession();if(!s?.access_token){p("Sign in required to view membership management."),S(!0);return}const n=await fetch(`${b}/api/users/onboarding-status`,{headers:{Authorization:`Bearer ${s.access_token}`}});if(!n.ok){p("Unable to verify permissions."),S(!0);return}(await n.json())?.profile?.role==="admin"?(B(!0),R(s.access_token)):p("Admin access required.")}catch(s){console.error("[MembershipAdmin] Access check failed:",s),p("Unable to verify permissions.")}finally{S(!0)}},D=async()=>{if(c){k(!0);try{const s={Authorization:`Bearer ${c}`};if(l===0){const n=await fetch(`${b}/api/membership/applications`,{headers:s});n.ok&&q(await n.json().then(m=>m.applications))}else{const n=await fetch(`${b}/api/membership/members`,{headers:s});n.ok&&F(await n.json().then(m=>m.members))}}catch(s){console.error("Failed to load:",s)}finally{k(!1)}}},U=async()=>{if(o)try{(await fetch(`${b}/api/membership/applications/${o.id}/approve`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify(r)})).ok&&(u(!1),T(null),D())}catch(s){console.error("Failed to approve:",s)}},W=s=>{switch(s){case"pending":return"warning";case"active":return"success";case"approved":return"success";case"rejected":return"error";case"expired":return"default";case"cancelled":return"error";default:return"default"}};return!I||y?e.jsx(C,{maxWidth:"md",sx:{py:4},children:e.jsx(i,{children:"Loading..."})}):A?e.jsxs(C,{maxWidth:"lg",sx:{py:4},children:[h&&e.jsx(d,{onClick:h,size:"small",variant:"contained",sx:{bgcolor:"white",color:"black",textTransform:"none",fontWeight:700,borderRadius:999,mb:1,"&:hover":{bgcolor:"grey.100"}},children:"Home"}),e.jsx(i,{variant:"h4",sx:{mb:3,fontWeight:700},children:"Membership Management"}),e.jsxs(G,{value:l,onChange:(s,n)=>N(n),sx:{mb:3},children:[e.jsx(E,{label:"Applications"}),e.jsx(E,{label:"Members"})]}),l===0&&e.jsx(M,{children:e.jsxs(z,{children:[e.jsxs(i,{variant:"h6",sx:{mb:2},children:["Membership Applications (",g.length,")"]}),y?e.jsx(i,{children:"Loading..."}):g.length===0?e.jsx(_,{severity:"info",children:"No applications yet"}):e.jsxs(L,{children:[e.jsx(P,{children:e.jsxs(j,{children:[e.jsx(t,{children:"Name"}),e.jsx(t,{children:"Email"}),e.jsx(t,{children:"Phone"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Submitted"}),e.jsx(t,{children:"Actions"})]})}),e.jsx($,{children:g.map(s=>e.jsxs(j,{children:[e.jsx(t,{children:s.full_name}),e.jsx(t,{children:s.email}),e.jsx(t,{children:s.phone||"-"}),e.jsx(t,{children:e.jsx(w,{label:s.status,color:W(s.status),size:"small"})}),e.jsx(t,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(t,{children:s.status==="pending"&&e.jsx(d,{size:"small",variant:"contained",onClick:()=>{T(s),u(!0)},children:"Approve"})})]},s.id))})]})]})}),l===1&&e.jsx(M,{children:e.jsxs(z,{children:[e.jsxs(i,{variant:"h6",sx:{mb:2},children:["Active Members (",v.length,")"]}),y?e.jsx(i,{children:"Loading..."}):v.length===0?e.jsx(_,{severity:"info",children:"No members yet"}):e.jsxs(L,{children:[e.jsx(P,{children:e.jsxs(j,{children:[e.jsx(t,{children:"Name"}),e.jsx(t,{children:"Email"}),e.jsx(t,{children:"Tier"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Joined"}),e.jsx(t,{children:"Expires"})]})}),e.jsx($,{children:v.map(s=>e.jsxs(j,{children:[e.jsx(t,{children:s.full_name}),e.jsx(t,{children:s.email}),e.jsx(t,{children:e.jsx(w,{label:s.tier,color:"primary",size:"small"})}),e.jsx(t,{children:e.jsx(w,{label:s.status,color:W(s.status),size:"small"})}),e.jsx(t,{children:new Date(s.joined_at).toLocaleDateString()}),e.jsx(t,{children:s.expires_at?new Date(s.expires_at).toLocaleDateString():"Never"})]},s.id))})]})]})}),e.jsxs(K,{open:H,onClose:()=>u(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Q,{children:"Approve Membership"}),e.jsx(V,{children:o&&e.jsxs(X,{spacing:2,sx:{pt:1},children:[e.jsxs(i,{variant:"body2",children:[e.jsx("strong",{children:"Applicant:"})," ",o.full_name," (",o.email,")"]}),e.jsx(f,{label:"Payment Amount",type:"number",fullWidth:!0,value:r.payment_amount,onChange:s=>x({...r,payment_amount:s.target.value})}),e.jsx(f,{label:"Payment Reference",fullWidth:!0,value:r.payment_reference,onChange:s=>x({...r,payment_reference:s.target.value})}),e.jsxs(f,{label:"Tier",select:!0,fullWidth:!0,value:r.tier,onChange:s=>x({...r,tier:s.target.value}),SelectProps:{native:!0},children:[e.jsx("option",{value:"full",children:"Full"}),e.jsx("option",{value:"premium",children:"Premium"})]}),e.jsx(f,{label:"Expires At (optional)",type:"date",fullWidth:!0,value:r.expires_at,onChange:s=>x({...r,expires_at:s.target.value}),InputLabelProps:{shrink:!0}})]})}),e.jsxs(Y,{children:[e.jsx(d,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(d,{onClick:U,variant:"contained",children:"Approve & Create Membership"})]})]})]}):e.jsxs(C,{maxWidth:"sm",sx:{py:6},children:[h&&e.jsx(d,{onClick:h,size:"small",variant:"contained",sx:{mb:2},children:"Home"}),e.jsx(_,{severity:"warning",children:J||"Admin access required to view membership management."})]})}export{ae as default};
