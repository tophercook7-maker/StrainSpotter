import{r as a,j as e,C as v,i as b,S as c,T as t,A as i,f as y,h as w,H as u,Z as k,B as C}from"./react-vendor-CxfKVgr3.js";import{s as S,a as E}from"./App-JmJcCWdD.js";import"./vendor-DCH4KwNm.js";function z({onBack:l}){const[d,o]=a.useState([]),[x,h]=a.useState(!0),[m,r]=a.useState(""),g=async()=>{h(!0);try{const{data:{session:s}}=await S.auth.getSession();if(!s?.access_token){r("Sign in as an admin to view recent errors."),o([]);return}const n=await fetch(`${E}/api/admin/errors/recent?limit=100`,{headers:{Authorization:`Bearer ${s.access_token}`}});if(!n.ok){const f=await n.text();r(f||"Failed to load errors"),o([]);return}const j=await n.json();o(j.errors||[]),r(j.message||"")}catch(s){r(`Connection error: ${s.message}`),o([])}finally{h(!1)}};a.useEffect(()=>{g()},[]);const p=s=>s>=500?"error":s>=400?"warning":"default";return e.jsxs(v,{maxWidth:"lg",sx:{py:4},children:[l&&e.jsx(b,{onClick:l,size:"small",variant:"contained",sx:{bgcolor:"white",color:"black",textTransform:"none",fontWeight:700,borderRadius:999,mb:1,"&:hover":{bgcolor:"grey.100"}},children:"Home"}),e.jsxs(c,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:3},children:[e.jsx(t,{variant:"h4",fontWeight:"bold",children:"üö® Error Logs"}),e.jsx(b,{variant:"contained",onClick:g,disabled:x,children:"Refresh"})]}),m&&e.jsx(i,{severity:"info",sx:{mb:3},children:m}),x?e.jsx(t,{children:"Loading..."}):d.length===0?e.jsx(i,{severity:"success",children:"‚úÖ No recent errors! Everything is running smoothly."}):e.jsx(c,{spacing:2,children:d.map((s,n)=>e.jsx(y,{sx:{bgcolor:(s.status_code||0)>=500?"rgba(211, 47, 47, 0.05)":"rgba(255, 152, 0, 0.05)",border:`1px solid ${(s.status_code||0)>=500?"#d32f2f44":"#ff980044"}`},children:e.jsxs(w,{children:[e.jsxs(c,{direction:"row",spacing:2,alignItems:"center",sx:{mb:2},children:[e.jsx(u,{label:`${s.status_code??"n/a"}`,color:p(s.status_code??0),size:"small"}),e.jsx(u,{label:s.method||"SERVER",variant:"outlined",size:"small"}),e.jsx(t,{variant:"caption",color:"text.secondary",children:new Date(s.created_at).toLocaleString()}),e.jsxs(t,{variant:"caption",color:"text.secondary",sx:{ml:"auto"},children:["User: ",s.user_id||"n/a"]})]}),e.jsxs(t,{variant:"body2",fontWeight:"bold",sx:{mb:1},children:["Endpoint: ",e.jsx("code",{children:s.path})]}),e.jsxs(t,{variant:"body1",color:"error.main",sx:{mb:2},children:["‚ùå ",s.message]}),s.context?.client&&e.jsxs(i,{severity:"info",sx:{mb:2},children:["Client crash on ",s.context.client.currentView||s.context.client.location||"unknown view",e.jsx("br",{}),s.context.client.userAgent]}),s.stack&&e.jsxs(e.Fragment,{children:[e.jsx(k,{sx:{my:2}}),e.jsx(t,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"Stack Trace:"}),e.jsx(C,{component:"pre",sx:{bgcolor:"rgba(0,0,0,0.05)",p:2,borderRadius:1,fontSize:"0.75rem",overflow:"auto",maxHeight:200},children:s.stack})]})]})},n))}),e.jsxs(i,{severity:"info",sx:{mt:4},children:[e.jsx(t,{variant:"body2",fontWeight:"bold",sx:{mb:1},children:"üí° How to view full logs:"}),e.jsxs(t,{variant:"body2",component:"div",children:["‚Ä¢ ",e.jsx("strong",{children:"PM2 logs:"})," ",e.jsx("code",{children:"pm2 logs strainspotter-backend"})]}),e.jsxs(t,{variant:"body2",component:"div",children:["‚Ä¢ ",e.jsx("strong",{children:"PM2 errors only:"})," ",e.jsx("code",{children:"pm2 logs strainspotter-backend --err"})]}),e.jsxs(t,{variant:"body2",component:"div",children:["‚Ä¢ ",e.jsx("strong",{children:"PM2 flush logs:"})," ",e.jsx("code",{children:"pm2 flush"})]}),e.jsxs(t,{variant:"body2",component:"div",sx:{mt:1},children:["‚Ä¢ ",e.jsx("strong",{children:"Browser console:"})," Open DevTools (F12) ‚Üí Console tab to see frontend errors"]})]})]})}export{z as default};
