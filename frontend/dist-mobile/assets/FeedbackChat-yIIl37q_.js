import{r as a,j as s,B as c,i as l,f as w,h as v,T as r,S as y,m as E}from"./react-vendor-CxfKVgr3.js";import{a as n}from"./App-JmJcCWdD.js";import"./vendor-DCH4KwNm.js";function N({onBack:d}){const[b,k]=a.useState([]),[h,x]=a.useState(""),[j,m]=a.useState(!1),[p,f]=a.useState(!1),[o,i]=a.useState(null),g=async()=>{try{const e=await fetch(`${n}/api/feedback/messages`);e.ok&&k(await e.json())}catch(e){console.error("[Feedback] Load error:",e)}},S=async()=>{f(!0),i(null);try{const t=await(await fetch(`${n}/diagnostic/email-test`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:"strainspotter25feedback@gmail.com"})})).json();i(t.ok?"Email sent!":`Error: ${t.error||"Unknown"}`)}catch{i("Network error")}f(!1)};a.useEffect(()=>{g()},[]);const u=async()=>{const e=h.trim();if(e){m(!0);try{console.log("[Feedback] Sending to:",`${n}/api/feedback/messages`);const t=await fetch(`${n}/api/feedback/messages`,{method:"POST",headers:{"Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJkcXB4aXhzYnFjc3lmZXdjbWJ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAxMjI3NTMsImV4cCI6MjA3NTY5ODc1M30.rTbYZNKNv1szvzjA2D828OVt7qUZVSXgi4G_tUqm3mA"},body:JSON.stringify({content:e,user_id:null})});if(t.ok)x(""),await g();else{const T=await t.text();console.error("[Feedback] Send failed:",T),alert("Failed to send feedback. Please try again.")}}catch(t){console.error("[Feedback] Error:",t),alert("Network error sending feedback.")}finally{m(!1)}}},I=e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),u())};return s.jsxs(c,{sx:{p:2},children:[d&&s.jsx(l,{onClick:d,size:"small",variant:"contained",sx:{bgcolor:"white",color:"black",textTransform:"none",fontWeight:700,borderRadius:999,mb:2,"&:hover":{bgcolor:"grey.100"}},children:"Home"}),s.jsx(w,{sx:{bgcolor:"rgba(255,255,255,0.7)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.37)",backdropFilter:"blur(12px)",borderRadius:4,border:"1px solid rgba(255,255,255,0.18)"},children:s.jsxs(v,{children:[s.jsx(r,{variant:"h6",sx:{mb:2},children:"Feedback"}),s.jsxs(y,{spacing:1,sx:{mb:2,maxHeight:300,overflow:"auto"},children:[b.map(e=>s.jsxs(c,{sx:{p:1,bgcolor:"background.default",borderRadius:1},children:[s.jsx(r,{variant:"body2",color:"text.secondary",children:new Date(e.created_at).toLocaleString()}),s.jsx(r,{variant:"body1",children:e.content})]},e.id)),b.length===0&&s.jsx(r,{variant:"body2",color:"text.secondary",children:"No feedback yet. Be the first!"})]}),s.jsxs(y,{direction:"row",spacing:1,children:[s.jsx(E,{fullWidth:!0,size:"small",placeholder:"Type feedback... (press Enter to send)",value:h,onChange:e=>x(e.target.value),onKeyPress:I}),s.jsx(l,{variant:"outlined",size:"small",onClick:S,disabled:p,sx:{textTransform:"none"},children:p?"Sending...":"Send Test Email"}),s.jsx(l,{variant:"contained",onClick:u,disabled:j,children:"Send"})]}),o&&s.jsx(c,{sx:{px:2,pb:1},children:s.jsx(r,{variant:"body2",color:o==="Email sent!"?"success.main":"error.main",children:o})})]})})]})}export{N as default};
