import{r as c,j as e,D as C,p as S,q as D,S as j,m as s,B as W,E as k,H as w,u as E,i as y}from"./react-vendor-CxfKVgr3.js";import{s as T,a as B}from"./App-JmJcCWdD.js";const b=r=>{const n=r&&typeof r=="object"?r:{};return{strain_name:n.strain_name||"",strain_slug:n.strain_slug||"",entry_date:new Date().toISOString().slice(0,10),rating:n.rating||0,notes:"",method:"",dosage:"",time_of_day:"",tags:""}};function J({open:r,defaults:n,onClose:g,onSaved:v}){const[a,h]=c.useState(()=>b(n)),[m,p]=c.useState(!1),[x,f]=c.useState(null);c.useEffect(()=>{h(b(n))},[n,r]);const t=l=>(i,u)=>{if(l==="rating"){h(o=>({...o,rating:u||0}));return}const d=i?.target?.value??"";h(o=>({...o,[l]:d}))},_=async()=>{p(!0),f(null);try{const{data:l}=await T.auth.getSession(),i=l?.session?.access_token,u=await fetch(`${B}/api/journals`,{method:"POST",headers:{"Content-Type":"application/json",...i?{Authorization:`Bearer ${i}`}:{}},body:JSON.stringify({...a,tags:a.tags?a.tags.split(",").map(o=>o.trim()).filter(Boolean):[]})}),d=await u.json().catch(()=>({}));if(!u.ok)throw new Error(d.error||"Failed to save journal entry.");v?.(d),g?.()}catch(l){f(l.message||"Unable to save entry.")}finally{p(!1)}};return e.jsxs(C,{open:r,onClose:g,fullWidth:!0,maxWidth:"sm",children:[e.jsx(S,{children:"Log your experience"}),e.jsx(D,{dividers:!0,children:e.jsxs(j,{spacing:2,sx:{mt:1},children:[e.jsx(s,{label:"Strain name",value:a.strain_name,onChange:t("strain_name"),fullWidth:!0}),e.jsx(s,{label:"Strain slug / nickname",value:a.strain_slug,onChange:t("strain_slug"),fullWidth:!0}),e.jsx(s,{label:"Date",type:"date",value:a.entry_date,onChange:t("entry_date"),InputLabelProps:{shrink:!0},fullWidth:!0}),e.jsx(W,{children:e.jsx(k,{value:a.rating,onChange:t("rating"),size:"large"})}),e.jsx(s,{label:"Consumption method",value:a.method,onChange:t("method"),placeholder:"Joint, vape, edible...",fullWidth:!0}),e.jsxs(j,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(s,{label:"Dosage",value:a.dosage,onChange:t("dosage"),placeholder:"0.5g, 5mg edible...",fullWidth:!0}),e.jsx(s,{label:"Time of day",value:a.time_of_day,onChange:t("time_of_day"),placeholder:"Morning, Night...",fullWidth:!0})]}),e.jsx(s,{label:"Tags",value:a.tags,onChange:t("tags"),placeholder:"sleep, focus",helperText:"Comma-separated keywords",fullWidth:!0}),e.jsx(s,{label:"Notes",value:a.notes,onChange:t("notes"),fullWidth:!0,multiline:!0,rows:4}),x&&e.jsx(w,{color:"error",label:x})]})}),e.jsxs(E,{children:[e.jsx(y,{onClick:g,disabled:m,children:"Cancel"}),e.jsx(y,{variant:"contained",onClick:_,disabled:m,children:"Save entry"})]})]})}export{J};
