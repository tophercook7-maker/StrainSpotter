import{r as m}from"./react-vendor-CxfKVgr3.js";import{u as S,c as h,s as I,a as p}from"./App-JmJcCWdD.js";function w(){const{user:n,session:i}=S(),{isFounder:u,founderUnlimitedEnabled:d}=h(),[f,e]=m.useState({loading:!0,error:null,remainingScans:0,isUnlimited:!1});return m.useEffect(()=>{if(!n&&!i){e({loading:!1,error:null,remainingScans:20,isUnlimited:!1});return}if(u&&d){e({loading:!1,error:null,remainingScans:1/0,isUnlimited:!0});return}let t=!1;return(async()=>{try{if(!(n?.id||i?.user?.id)){e(a=>({...a,loading:!1,error:"No user ID available"}));return}const{data:{session:s}}=await I.auth.getSession();if(!s){e(a=>({...a,loading:!1,error:"Not authenticated"}));return}const l=await fetch(`${p}/api/credits/balance`,{headers:{Authorization:`Bearer ${s.access_token}`}});if(t)return;if(!l.ok){const a=await l.json().catch(()=>({}));throw new Error(a.error||"Unable to load credit balance")}const r=await l.json(),c=!!(r.unlimited||r.isUnlimited||r.tier==="admin"||r.membershipTier==="founder_unlimited"),g=c?Number.POSITIVE_INFINITY:r.creditsRemaining??0;e({loading:!1,error:null,remainingScans:g,isUnlimited:c})}catch(o){if(t)return;e(s=>({...s,loading:!1,error:o?.message||String(o)}))}})(),()=>{t=!0}},[n?.id,n?.email,i?.user?.id,i?.user?.email,u,d]),f}export{w as u};
