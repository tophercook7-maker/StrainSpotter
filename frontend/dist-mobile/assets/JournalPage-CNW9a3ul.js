import{r as n,j as e,B as l,C as w,S as o,aW as B,T as c,i as y,n as W,ag as I,ah as v,Z as L,f as F,h as J,H as d}from"./react-vendor-CxfKVgr3.js";import{s as M,a as T}from"./App-JmJcCWdD.js";import{E as C}from"./EmptyStateCard-sMvJRayT.js";import{J as U}from"./JournalDialog-D1DsrI9a.js";import"./vendor-DCH4KwNm.js";function R({onBack:g}){const[i,j]=n.useState([]),[x,p]=n.useState(!0),[u,b]=n.useState(null),[h,S]=n.useState("all"),[k,m]=n.useState(!1),[E,A]=n.useState(null),f=n.useCallback(async()=>{p(!0),b(null);try{const{data:a}=await M.auth.getSession(),s=a?.session?.access_token;if(!s){j([]),p(!1);return}const t=await fetch(`${T}/api/journals`,{headers:{Authorization:`Bearer ${s}`}}),r=await t.json().catch(()=>[]);if(!t.ok)throw new Error(r.error||"Failed to load journal entries.");j(Array.isArray(r)?r:[])}catch(a){b(a.message||"Unable to load journals.")}finally{p(!1)}},[]);n.useEffect(()=>{f()},[f]);const _=n.useMemo(()=>{const a=h==="all"?i:i.filter(t=>t.strain_slug===h),s=new Map;return a.forEach(t=>{const r=t.entry_date||t.created_at?.split("T")[0]||"Unknown Date";s.has(r)||s.set(r,[]),s.get(r).push(t)}),Array.from(s.entries()).sort((t,r)=>new Date(r[0])-new Date(t[0]))},[i,h]),D=n.useMemo(()=>{const a=new Set;return i.forEach(s=>{s.strain_slug&&a.add(s.strain_slug)}),Array.from(a)},[i]),z=a=>e.jsx(F,{variant:"outlined",sx:{mb:1.5,background:"rgba(255,255,255,0.04)",borderColor:"rgba(255,255,255,0.12)"},children:e.jsx(J,{children:e.jsxs(o,{spacing:1,children:[e.jsxs(o,{direction:"row",justifyContent:"space-between",children:[e.jsx(c,{variant:"subtitle1",fontWeight:700,children:a.strain_name||a.strain_slug||"Unknown strain"}),a.rating?e.jsx(d,{size:"small",color:"success",label:`${a.rating}/5`}):null]}),a.notes&&e.jsx(c,{variant:"body2",children:a.notes}),e.jsxs(o,{direction:"row",spacing:1,flexWrap:"wrap",children:[a.method&&e.jsx(d,{size:"small",label:a.method}),a.dosage&&e.jsx(d,{size:"small",label:a.dosage}),a.time_of_day&&e.jsx(d,{size:"small",label:a.time_of_day}),(a.tags||[]).map(s=>e.jsx(d,{size:"small",variant:"outlined",label:`#${s}`},s))]})]})})},a.id);return e.jsxs(l,{sx:{display:"flex",flexDirection:"column",height:"100vh",overflow:"hidden"},children:[e.jsx(l,{sx:{flexShrink:0,py:2,px:2,borderBottom:"1px solid rgba(255,255,255,0.08)",bgcolor:"transparent",backdropFilter:"blur(10px)",zIndex:1},children:e.jsx(w,{maxWidth:"md",children:e.jsxs(o,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(o,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(B,{sx:{color:"#7CB342"}}),e.jsx(c,{variant:"h5",fontWeight:800,sx:{color:"#fff"},children:"Journal"})]}),e.jsxs(o,{direction:"row",spacing:1,children:[g&&e.jsx(y,{variant:"outlined",onClick:g,sx:{color:"#fff",borderColor:"rgba(255,255,255,0.3)"},children:"Back"}),e.jsx(y,{variant:"contained",onClick:()=>{A(null),m(!0)},children:"New entry"})]})]})})}),e.jsx(l,{sx:{flex:1,minHeight:0,overflowY:"auto",WebkitOverflowScrolling:"touch"},children:e.jsxs(w,{maxWidth:"md",sx:{py:4},children:[x&&e.jsx(l,{sx:{display:"flex",justifyContent:"center",py:5},children:e.jsx(W,{})}),!x&&u&&e.jsx(C,{title:"Unable to load journal",description:u,actionLabel:"Retry",onAction:f}),!x&&!u&&i.length===0&&e.jsx(C,{title:"No entries yet",description:"Capture how each strain made you feel, the dosage, and what youâ€™d change next time.",actionLabel:"Scan your first strain",onAction:()=>window.dispatchEvent(new CustomEvent("nav:set-view",{detail:"scanner"})),secondaryActionLabel:"Add a manual entry",onSecondaryAction:()=>m(!0)}),!x&&!u&&i.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(o,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2},alignItems:"center",children:[e.jsx(c,{variant:"body2",color:"text.secondary",children:"Filter by strain"}),e.jsxs(I,{size:"small",value:h,onChange:a=>S(a.target.value),sx:{minWidth:200},children:[e.jsx(v,{value:"all",children:"All strains"}),D.map(a=>e.jsx(v,{value:a,children:a},a))]})]}),e.jsx(o,{spacing:3,children:_.map(([a,s])=>e.jsxs(l,{children:[e.jsx(c,{variant:"subtitle2",sx:{textTransform:"capitalize",color:"rgba(255,255,255,0.7)"},children:new Date(a).toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric"})}),e.jsx(L,{sx:{my:1,opacity:.2}}),s.map(z)]},a))})]})]})}),e.jsx(U,{open:k,defaults:E,onClose:()=>m(!1),onSaved:()=>{m(!1),f()}})]})}export{R as default};
