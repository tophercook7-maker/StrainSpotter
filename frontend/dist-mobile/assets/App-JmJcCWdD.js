const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Home-Bd6DTWkh.js","./react-vendor-CxfKVgr3.js","./vendor-DCH4KwNm.js","./ScanWizard-CpU8GmcI.js","./SeedVendorFinder-tPICLvgV.js","./BackHeader-jnSvreF0.js","./ScanResultCard-Cv4hIP62.js","./useStrainImage-pCt_md2M.js","./useCanScan-Cd4tphRX.js","./useCreditBalance-DnPtH5jr.js","./StrainBrowser-ChteOdTX.js","./JournalDialog-D1DsrI9a.js","./EmptyStateCard-sMvJRayT.js","./Groups-C1u7l6VL.js","./GrowCoach--krqYoX3.js","./GrowerDirectory-eymkC7u0.js","./GrowerRegistration-CDt-qoyN.js","./BuyScansModal-BsHu5l_I.js","./roles-BG0liTN4.js","./ScanPage-BsI9T-Ue.js","./HistoryPage-BAItD3Yz.js","./AnalyticsDashboard-BFPF3lG7.js","./ScanHistory-DwPk8_G9.js","./router-vendor-C0qkbn0g.js","./FeedbackChat-yIIl37q_.js","./Seeds-duhzdiwO.js","./Dispensaries-DMkEjtsF.js","./Help-DKXKUHLt.js","./Friends-BIs2rw0v.js","./MembershipJoin-CFe6bnyw.js","./MembershipAdmin-DxZ7O2Lm.js","./PipelineStatus-BPXmHUle.js","./ModerationDashboard-V8QTY4gw.js","./Guidelines-CYr1yumv.js","./ErrorViewer-CFoGki2A.js","./EmergencyLogout-DD82G-zk.js","./OnboardingFlow-Cax6Ms8_.js","./FirstRunIntro-BmULqsnv.js","./JournalPage-CNW9a3ul.js","./FloatingScanButton-rj4cR8P3.js","./ScanBalanceIndicator-CJIAwXrV.js","./AdminStatus-CXdSHwRU.js"])))=>i.map(i=>d[i]);
import{B as ve,A as b}from"./vendor-DCH4KwNm.js";import{r as t,j as e,B as y,C as X,T as a,F as je,f as K,h as H,G as Se,L as ke,S as z,V as ee,i as E,A as L,k as _e,l as te,m as G,n as $,o as Ee,D as Ce,p as Ae,q as Ie,s as Pe,t as Re,u as Te,R as u,v as re,w as Le,x as oe}from"./react-vendor-CxfKVgr3.js";const Oe="https://rdqpxixsbqcsyfewcmbz.supabase.co",me="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJkcXB4aXhzYnFjc3lmZXdjbWJ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAxMjI3NTMsImV4cCI6MjA3NTY5ODc1M30.rTbYZNKNv1szvzjA2D828OVt7qUZVSXgi4G_tUqm3mA",v=ve(Oe,me,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:typeof window<"u"?window.localStorage:void 0}});function Y(){return!!me}const xe=t.createContext({user:null,session:null,loading:!0,signOut:()=>{}}),ne=["https://strainspotter.onrender.com",void 0,"https://strainspotter.onrender.com",void 0].map(o=>typeof o=="string"?o.trim():"").filter(Boolean),N=ne.length?ne[0]:"",Z=typeof window<"u"&&/localhost|127\.0\.0\.1/.test(window.location.host),ze=N&&/localhost|127\.0\.0\.1/.test(N),Q=typeof window<"u"&&window.location.protocol==="capacitor:",se="https://strainspotter.onrender.com",Me=Q?!N||/localhost|127\.0\.0\.1/.test(N)?se:N:Z?ze?N:"http://localhost:5181":N||se,W=Me.replace(/\/$/,"");console.log("[Config] API_BASE:",W);console.log("[Config] isCapacitor:",Q);console.log("[Config] isLocalhost:",Z);!Z&&!Q&&!N&&console.warn("[Config] VITE_API_BASE not set. Falling back to default remote API.");const We=`${W}/api`,Ot=We.replace(/\/$/,""),Be="topher.cook7@gmail.com",ae=!0;function be(o){if(!o)return!1;const s=o.email?.toLowerCase()??"";if(s==="topher.cook7@gmail.com"||s==="strainspotter25@gmail.com")return!0;const n=o.user_metadata||{};return n.role==="founder"||n.isFounder===!0}function De(o){return!o||typeof o!="string"?!1:o.toLowerCase().trim()===Be.toLowerCase()}function ie(o){if(!o?.user?.email)return o;const s=o.user.email;return De(s)?{...o,user:{...o.user,creditStatus:{unlimited:!0,remainingScans:Number.POSITIVE_INFINITY,membershipTier:"founder_unlimited",isMember:!0,canScan:!0}}}:o}function Fe({children:o}){const[s,n]=t.useState(null),[r,x]=t.useState(null),[w,j]=t.useState(!0),h=be(s||r?.user),p=(r?.user?.email||s?.email||"").toLowerCase().trim();t.useEffect(()=>{p&&console.log("[FounderDebug]",{email:p,FOUNDER_UNLIMITED_ENABLED:ae,isFounder:h})},[p,h]),t.useEffect(()=>{if(!v){j(!1);return}v.auth.getSession().then(({data:{session:g}})=>{console.log("[AuthContext] Initial session:",g?.user?.email||"none");const i=ie(g);x(i),n(i?.user??null),j(!1)});const{data:{subscription:d}}=v.auth.onAuthStateChange(async(g,i)=>{console.log("[AuthContext] Auth state change:",g,i?.user?.email||"none");const l=ie(i);if(x(l),n(l?.user??null),j(!1),i?.user?.id&&(g==="SIGNED_IN"||g==="USER_UPDATED"))try{await fetch(`${W}/api/users/ensure`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:i.user.id,email:i.user.email,username:i.user.user_metadata?.username||i.user.email?.split("@")[0]||`user_${i.user.id.substring(0,8)}`})}),console.log("[AuthContext] User record ensured for:",i.user.email)}catch(f){console.error("[AuthContext] Failed to ensure user record:",f)}});return()=>d.unsubscribe()},[]);const c={user:s,session:r,loading:w,signOut:async()=>{v&&(await v.auth.signOut(),console.log("[AuthContext] User signed out"))},isFounder:!!h,FOUNDER_UNLIMITED_ENABLED:!!ae};return e.jsx(xe.Provider,{value:c,children:o})}function Ne(){const o=t.useContext(xe);if(!o)throw new Error("useAuth must be used within an AuthProvider");return o}const ye=t.createContext(null);function Ue({children:o}){const{user:s,session:n}=Ne(),[r,x]=t.useState(null),[w,j]=t.useState(!1),[h,p]=t.useState(!1),S=t.useMemo(()=>{s?.email||n?.user?.email;const l=be(s||n?.user);return{isFounder:l,founderUnlimitedEnabled:l&&!0}},[s,n]);t.useEffect(()=>{try{const l=localStorage.getItem("strainspotter_pro_mode");if(!l)return;const f=JSON.parse(l);f&&(f.proRole==="dispensary"||f.proRole==="grower")&&(x(f.proRole),j(!!f.proEnabled))}catch(l){console.warn("[ProMode] Failed to parse local storage",l)}},[]);function c(l){try{localStorage.setItem("strainspotter_pro_mode",JSON.stringify(l))}catch(f){console.warn("[ProMode] Failed to persist",f)}}async function d(l){p(!0);try{const f=await fetch(`${W}/api/pro/validate-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:l})});if(!f.ok){const B=await f.text().catch(()=>"");let A="Invalid access code. Please check and try again.";try{const R=JSON.parse(B);R.error&&(A=R.error)}catch{}throw new Error(A)}const C=await f.json();if(!C.ok||!C.role)throw new Error("Invalid response from server.");return x(C.role),j(!0),c({proRole:C.role,proEnabled:!0}),{ok:!0,role:C.role}}catch(f){throw console.error("[ProMode] activateProWithCode error",f),f}finally{p(!1)}}function g(){x(null),j(!1),c({proRole:null,proEnabled:!1})}const i={proRole:r,proEnabled:w,proLoading:h,activateProWithCode:d,clearProMode:g,isFounder:S.isFounder,founderUnlimitedEnabled:S.founderUnlimitedEnabled};return e.jsx(ye.Provider,{value:i,children:o})}function zt(){const o=t.useContext(ye);if(!o)throw new Error("useProMode must be used within ProModeProvider");return o}function Ve({children:o}){const[s,n]=t.useState(!0),[r,x]=t.useState(!1),[w,j]=t.useState(!1);return t.useEffect(()=>{const h=typeof window<"u"&&window.location.protocol!=="capacitor:";j(h),x(!0);const S=()=>{const c=navigator.userAgent.toLowerCase(),d=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini|mobile|tablet/i.test(c),g=window.innerWidth<=1024;n(d||g)};return S(),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]),w?e.jsx(e.Fragment,{children:o}):r?r&&!s?e.jsx(X,{maxWidth:"sm",children:e.jsx(y,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",px:3,background:"linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%)"},children:e.jsxs(y,{sx:{bgcolor:"rgba(124, 179, 66, 0.1)",border:"2px solid rgba(124, 179, 66, 0.3)",borderRadius:4,p:4,maxWidth:400},children:[e.jsx(a,{variant:"h4",sx:{color:"#9CCC65",fontWeight:700,mb:2,fontSize:{xs:"1.5rem",sm:"2rem"}},children:"ðŸ“± Mobile Only"}),e.jsx(a,{variant:"body1",sx:{color:"#fff",mb:3,lineHeight:1.6},children:"StrainSpotter is designed exclusively for mobile devices and tablets."}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:2},children:"Please access this app from:"}),e.jsxs(y,{sx:{bgcolor:"rgba(0, 0, 0, 0.3)",borderRadius:2,p:2,mb:3},children:[e.jsx(a,{variant:"body2",sx:{color:"#9CCC65",mb:1},children:"ðŸ“± iPhone or Android phone"}),e.jsx(a,{variant:"body2",sx:{color:"#9CCC65"},children:"ðŸ“± iPad or Android tablet"})]}),e.jsx(a,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.5)",display:"block",mt:2},children:"Scan the QR code with your mobile device or visit this URL on your phone"})]})})}):o:e.jsxs(e.Fragment,{children:[e.jsx(y,{sx:{position:"fixed",top:0,left:0,right:0,bgcolor:"rgba(255, 152, 0, 0.9)",color:"#fff",py:.5,px:2,zIndex:9999,textAlign:"center",fontSize:"0.75rem",fontWeight:600},children:"ðŸ”§ DEV MODE - Desktop access enabled for development"}),e.jsx(y,{sx:{pt:{xs:0,sm:4}},children:o})]})}function Ge({onVerify:o}){const[s,n]=t.useState(!1);return t.useEffect(()=>{n(!0)},[]),e.jsx(y,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #0a1f0a 0%, #1a3a1a 25%, #2d5a2d 50%, #1a3a1a 75%, #0a1f0a 100%)",position:"relative",overflow:"hidden","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:`
            radial-gradient(circle at 20% 30%, rgba(76, 175, 80, 0.15) 0%, transparent 50%),
            radial-gradient(circle at 80% 70%, rgba(139, 195, 74, 0.15) 0%, transparent 50%),
            radial-gradient(circle at 50% 50%, rgba(124, 179, 66, 0.1) 0%, transparent 70%)
          `,animation:"pulse 8s ease-in-out infinite","@keyframes pulse":{"0%, 100%":{opacity:.5},"50%":{opacity:1}}},"&::after":{content:'""',position:"absolute",top:"-50%",left:"-50%",width:"200%",height:"200%",background:`
            repeating-linear-gradient(
              0deg,
              transparent,
              transparent 2px,
              rgba(76, 175, 80, 0.03) 2px,
              rgba(76, 175, 80, 0.03) 4px
            )
          `,animation:"scan 20s linear infinite","@keyframes scan":{"0%":{transform:"translateY(0)"},"100%":{transform:"translateY(50px)"}}}},children:e.jsx(X,{maxWidth:"sm",sx:{position:"relative",zIndex:1},children:e.jsx(je,{in:s,timeout:1e3,children:e.jsx(K,{elevation:24,sx:{background:"linear-gradient(135deg, rgba(28, 28, 28, 0.95) 0%, rgba(31, 58, 31, 0.95) 100%)",backdropFilter:"blur(20px)",border:"2px solid transparent",backgroundClip:"padding-box",position:"relative","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"inherit",padding:"2px",background:"linear-gradient(135deg, #4caf50, #8bc34a, #4caf50)",WebkitMask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"xor",maskComposite:"exclude",animation:"borderGlow 3s ease-in-out infinite","@keyframes borderGlow":{"0%, 100%":{opacity:.5},"50%":{opacity:1}}}},children:e.jsxs(H,{sx:{p:5,textAlign:"center"},children:[e.jsx(Se,{in:s,timeout:1200,children:e.jsxs(y,{sx:{position:"relative",display:"inline-block",mb:2},children:[e.jsx(ke,{sx:{fontSize:120,color:"#4caf50",filter:"drop-shadow(0 0 30px rgba(76, 175, 80, 0.8))",animation:"float 3s ease-in-out infinite","@keyframes float":{"0%, 100%":{transform:"translateY(0px) rotate(0deg)"},"50%":{transform:"translateY(-10px) rotate(5deg)"}}}}),e.jsx(y,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"140px",height:"140px",border:"2px solid rgba(76, 175, 80, 0.3)",borderRadius:"50%",animation:"ripple 2s ease-out infinite","@keyframes ripple":{"0%":{transform:"translate(-50%, -50%) scale(0.8)",opacity:1},"100%":{transform:"translate(-50%, -50%) scale(1.5)",opacity:0}}}})]})}),e.jsx(a,{variant:"h2",gutterBottom:!0,fontWeight:"900",sx:{background:"linear-gradient(135deg, #4caf50 0%, #8bc34a 50%, #4caf50 100%)",backgroundSize:"200% auto",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",animation:"shimmer 3s linear infinite",letterSpacing:"2px",textShadow:"0 0 40px rgba(76, 175, 80, 0.5)","@keyframes shimmer":{"0%":{backgroundPosition:"0% center"},"100%":{backgroundPosition:"200% center"}}},children:"StrainSpotter"}),e.jsx(a,{variant:"h6",sx:{color:"#8bc34a",fontWeight:500,mb:4,textShadow:"0 0 20px rgba(139, 195, 74, 0.3)"},children:"AI-Powered Cannabis Strain Identification"}),e.jsxs(y,{sx:{my:4,p:4,background:"linear-gradient(135deg, rgba(76, 175, 80, 0.15) 0%, rgba(139, 195, 74, 0.15) 100%)",borderRadius:3,border:"1px solid rgba(76, 175, 80, 0.4)",boxShadow:"inset 0 0 20px rgba(76, 175, 80, 0.1)",position:"relative",overflow:"hidden","&::before":{content:'""',position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent)",animation:"shine 3s infinite","@keyframes shine":{"0%":{left:"-100%"},"100%":{left:"100%"}}}},children:[e.jsxs(z,{direction:"row",alignItems:"center",justifyContent:"center",spacing:1,mb:2,children:[e.jsx(ee,{sx:{color:"#4caf50",fontSize:32}}),e.jsx(a,{variant:"h4",fontWeight:"bold",sx:{color:"#4caf50"},children:"Age Verification"}),e.jsx(ee,{sx:{color:"#4caf50",fontSize:32}})]}),e.jsx(a,{variant:"h6",paragraph:!0,sx:{color:"#fff",fontWeight:500},children:"You must be 21 years or older"}),e.jsx(a,{variant:"body1",sx:{color:"rgba(255, 255, 255, 0.8)",lineHeight:1.8},children:'By clicking "I am 21+", you confirm that you meet the age requirement for cannabis-related content in your jurisdiction.'})]}),e.jsx(E,{variant:"contained",size:"large",fullWidth:!0,onClick:o,sx:{py:3,fontSize:"1.3rem",fontWeight:"bold",background:"linear-gradient(135deg, #4caf50 0%, #66bb6a 50%, #4caf50 100%)",backgroundSize:"200% auto",boxShadow:"0 8px 30px rgba(76, 175, 80, .4)",borderRadius:3,position:"relative",overflow:"hidden",transition:"all 0.3s ease","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(135deg, transparent 0%, rgba(255, 255, 255, 0.2) 50%, transparent 100%)",transform:"translateX(-100%)",transition:"transform 0.6s"},"&:hover":{background:"linear-gradient(135deg, #388e3c 0%, #4caf50 50%, #388e3c 100%)",backgroundSize:"200% auto",boxShadow:"0 12px 40px rgba(76, 175, 80, .6)",transform:"translateY(-2px)","&::before":{transform:"translateX(100%)"}},"&:active":{transform:"translateY(0px)"}},children:e.jsxs(z,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(y,{component:"img",src:"/hero.png?v=13",alt:"",sx:{width:28,height:28,borderRadius:"50%",filter:"drop-shadow(0 0 8px rgba(255, 255, 255, 0.8))",animation:"spin 10s linear infinite","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}}),e.jsx("span",{children:"I am 21 or Older"}),e.jsx(y,{component:"img",src:"/hero.png?v=13",alt:"",sx:{width:28,height:28,borderRadius:"50%",filter:"drop-shadow(0 0 8px rgba(255, 255, 255, 0.8))",animation:"spin 10s linear infinite reverse"}})]})}),e.jsxs(a,{variant:"caption",display:"block",sx:{mt:4,color:"rgba(255, 255, 255, 0.5)",lineHeight:1.6,fontSize:"0.85rem"},children:["Cannabis is for medical and recreational use in accordance with state laws.",e.jsx("br",{}),"Please consume responsibly and know your local regulations."]})]})})})})})}function Ye({onBack:o}){const[s,n]=t.useState(""),[r,x]=t.useState(""),[w,j]=t.useState("signin"),[h,p]=t.useState(!1),[S,c]=t.useState(null),[d,g]=t.useState(null),[i,l]=t.useState(null);t.useEffect(()=>{if(!v)return;const{data:_}=v.auth.onAuthStateChange((I,V)=>{g(V?.user||null)});return v.auth.getSession().then(({data:I})=>g(I.session?.user||null)),()=>_?.subscription?.unsubscribe()},[]);async function f(){if(!Y()){c("Auth not configured. Set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY.");return}p(!0),c(null),l(null);const{data:_,error:I}=await v.auth.signInWithPassword({email:s,password:r});if(I)c(I.message);else{if(!(_?.user?.email_confirmed_at||_?.session?.user?.email_confirmed_at)){await v.auth.signOut(),c("Please verify your email before signing in. Check your inbox for the confirmation link."),l(null);return}try{const{data:m}=await v.auth.getSession(),T=m?.session?.user;if(T?.id){const{data:D}=await v.from("profiles").select("username, avatar_url").eq("user_id",T.id).single();if(!D?.username||!D?.avatar_url)try{await fetch(`${W}/api/profile-generator/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:T.email,userId:T.id})})}catch(J){console.warn("[auth] Failed to generate profile:",J)}else await fetch(`${W}/api/users/ensure`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:T.id,email:T.email,username:D.username})})}}catch(m){console.warn("[auth] ensure user after sign-in failed:",m)}o&&setTimeout(()=>o(),500)}p(!1)}async function C(){if(!Y()){c("Auth not configured. Set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY.");return}p(!0),c(null),l(null);const _=typeof window<"u"?`${window.location.origin}/#/`:void 0,{data:I,error:V}=await v.auth.signUp({email:s,password:r,options:{emailRedirectTo:_}});p(!1),V?c(V.message):I?.user?.identities?.length===0?c('This email is already registered. Please sign in, or use "Forgot password" to reset.'):(c(null),l("Check your inbox to verify your email. You can sign in once you confirm."),j("signin"))}async function B(){await v?.auth.signOut()}async function A(){if(!Y()){c("Auth not configured.");return}p(!0),c(null),l(null);try{const _=typeof window<"u"?window.location.origin:void 0,{error:I}=await v.auth.signInWithOtp({email:s,options:{emailRedirectTo:_}});I?c(I.message):l("Magic link sent. Check your email and click the link to sign in.")}finally{p(!1)}}async function R(){if(!Y()){c("Auth not configured.");return}p(!0),c(null),l(null);try{const _=typeof window<"u"?`${window.location.origin}/#/`:void 0,{error:I}=await v.auth.resetPasswordForEmail(s,{redirectTo:_});I?c(I.message):l("Password reset email sent. Check your email and click the link to reset your password. The link expires in 1 hour.")}finally{p(!1)}}const M=["your@email.com","friend1@email.com","friend2@email.com","andrewbeck209@gmail.com"];if(!Y())return e.jsx(L,{severity:"info",children:"Auth is not configured. You can still browse features."});const U=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1");return d&&!U&&!M.includes(d.email)?e.jsx(L,{severity:"error",children:"This app is restricted. Only select users can access StrainSpotter web. Please use the mobile app."}):e.jsxs(y,{sx:{maxWidth:420,mx:"auto",py:4,background:"transparent"},children:[o&&e.jsx(E,{onClick:o,size:"small",variant:"contained",sx:{mb:2,bgcolor:"#7CB342",color:"white",textTransform:"none",fontWeight:700,borderRadius:999,"&:hover":{bgcolor:"#689f38"}},children:"â† Home"}),e.jsx(K,{sx:{background:"rgba(255,255,255,0.15)",backdropFilter:"blur(12px)",border:"2px solid rgba(0,0,0,0.12)",boxShadow:"none"},children:e.jsx(H,{children:e.jsxs(z,{spacing:2,children:[e.jsx(y,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(y,{sx:{width:80,height:80,borderRadius:"50%",background:"transparent",border:"2px solid rgba(124, 179, 66, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 0 30px rgba(124, 179, 66, 0.4)",overflow:"hidden"},children:e.jsx("img",{src:"/hero.png?v=13",alt:"StrainSpotter",style:{width:"100%",height:"100%",objectFit:"cover"}})})}),e.jsx(a,{variant:"h5",sx:{color:"black",fontSize:"2rem",fontWeight:700,textAlign:"center"},children:"Account"}),d?e.jsxs(e.Fragment,{children:[e.jsxs(a,{variant:"body2",children:["Signed in as ",d.email]}),e.jsx(E,{variant:"outlined",onClick:B,children:"Sign Out"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(_e,{value:w==="reset"?!1:w,onChange:(_,I)=>j(I),"aria-label":"auth mode",children:[e.jsx(te,{label:"Sign In",value:"signin"}),e.jsx(te,{label:"Sign Up",value:"signup"})]}),w!=="reset"&&e.jsx(G,{label:"Email",type:"email",value:s,onChange:_=>n(_.target.value),fullWidth:!0,sx:{background:"rgba(255,255,255,0.10)",color:"black",fontSize:"1.15rem",borderRadius:2,input:{color:"black"}},InputLabelProps:{style:{color:"black",fontWeight:600}}}),w==="signin"&&e.jsxs(e.Fragment,{children:[e.jsx(G,{label:"Password",type:"password",value:r,onChange:_=>x(_.target.value),fullWidth:!0,sx:{background:"rgba(255,255,255,0.10)",color:"black",fontSize:"1.15rem",borderRadius:2,input:{color:"black"}},InputLabelProps:{style:{color:"black",fontWeight:600}}}),S&&e.jsx(L,{severity:"error",sx:{fontSize:"1.1rem",color:"black",background:"rgba(255,255,255,0.10)"},children:S}),i&&e.jsx(L,{severity:"info",sx:{fontSize:"1.1rem",color:"black",background:"rgba(255,255,255,0.10)"},children:i}),e.jsxs(z,{direction:{xs:"column",sm:"row"},spacing:1,children:[e.jsx(E,{variant:"contained",onClick:f,disabled:h,sx:{fontSize:"1.1rem",color:"black",background:"rgba(255,255,255,0.20)",border:"1.5px solid black",boxShadow:"none",fontWeight:700},children:h?e.jsx($,{size:20}):"Sign In"}),e.jsx(E,{variant:"outlined",onClick:A,disabled:h,sx:{fontSize:"1.1rem",color:"black",border:"1.5px solid black",fontWeight:700},children:"Send Magic Link"}),e.jsx(E,{variant:"text",onClick:()=>{j("reset"),l(null),c(null)},disabled:h,sx:{fontSize:"1.1rem",color:"black",fontWeight:700},children:"Forgot Password?"})]})]}),w==="signup"&&e.jsxs(e.Fragment,{children:[e.jsx(G,{label:"Password",type:"password",value:r,onChange:_=>x(_.target.value),fullWidth:!0,sx:{background:"rgba(255,255,255,0.10)",color:"black",fontSize:"1.15rem",borderRadius:2,input:{color:"black"}},InputLabelProps:{style:{color:"black",fontWeight:600}}}),S&&e.jsx(L,{severity:"error",sx:{fontSize:"1.1rem",color:"black",background:"rgba(255,255,255,0.10)"},children:S}),i&&e.jsx(L,{severity:"info",sx:{fontSize:"1.1rem",color:"black",background:"rgba(255,255,255,0.10)"},children:i}),e.jsxs(z,{direction:{xs:"column",sm:"row"},spacing:1,children:[e.jsx(E,{variant:"contained",onClick:C,disabled:h,sx:{fontSize:"1.1rem",color:"black",background:"rgba(255,255,255,0.20)",border:"1.5px solid black",boxShadow:"none",fontWeight:700},children:h?e.jsx($,{size:20}):"Create Account"}),e.jsx(Ee,{component:"button",onClick:()=>j("signin"),sx:{alignSelf:"center",color:"black",fontWeight:700},children:"Already registered? Sign in"})]})]}),w==="reset"&&e.jsxs(e.Fragment,{children:[e.jsx(a,{variant:"body2",sx:{color:"black"},children:"Enter your account email and weâ€™ll send you a reset link."}),e.jsx(G,{label:"Account Email",type:"email",value:s,onChange:_=>n(_.target.value),fullWidth:!0,sx:{background:"rgba(255,255,255,0.10)",color:"black",fontSize:"1.15rem",borderRadius:2,input:{color:"black"}},InputLabelProps:{style:{color:"black",fontWeight:600}}}),S&&e.jsx(L,{severity:"error",sx:{fontSize:"1.1rem",color:"black",background:"rgba(255,255,255,0.10)"},children:S}),i&&e.jsx(L,{severity:"info",sx:{fontSize:"1.1rem",color:"black",background:"rgba(255,255,255,0.10)"},children:i}),e.jsxs(z,{direction:{xs:"column",sm:"row"},spacing:1,children:[e.jsx(E,{variant:"contained",onClick:R,disabled:h||!s,sx:{fontSize:"1.1rem",color:"black",background:"rgba(255,255,255,0.20)",border:"1.5px solid black",boxShadow:"none",fontWeight:700},children:h?e.jsx($,{size:20}):"Send Reset Email"}),e.jsx(E,{variant:"text",onClick:()=>{j("signin"),l(null),c(null)},sx:{fontSize:"1.1rem",color:"black",fontWeight:700},children:"Back to Sign In"})]})]})]})]})})})]})}const P={colors:{primary:{main:"#7CB342",light:"#9CCC65",dark:"#558B2F"},secondary:{main:"#9E9D24",light:"#C5E1A5",dark:"#827717"},text:{primary:"#9CCC65",secondary:"#7CB342"}},leafIcon:{viewBox:"0 0 64 64",path:"M32 6c2.8 8.2 9.6 14 18 16-8.4 2-15.2 7.8-18 16-2.8-8.2-9.6-14-18-16 8.4-2 15.2-7.8 18-16ZM32 44c-3.5-6.5-9.9-10.7-18-12 4 5.3 7.1 11.1 8.5 17.3 3.1 1.5 6.2 2.7 9.5 3.7v-9ZM32 44c3.5-6.5 9.9-10.7 18-12-4 5.3-7.1 11.1-8.5 17.3-3.1 1.5-6.2 2.7-9.5 3.7v-9Z"},borders:{primary:"2px solid #7CB342",subtle:"1px solid rgba(124, 179, 66, 0.3)"},shadows:{card:"0 4px 20px rgba(0, 0, 0, 0.5)",elevated:"0 8px 30px rgba(0, 0, 0, 0.7)"}},Je={palette:{mode:"dark",primary:{main:P.colors.primary.main,light:P.colors.primary.light,dark:P.colors.primary.dark},secondary:{main:P.colors.secondary.main,light:P.colors.secondary.light,dark:P.colors.secondary.dark},background:{default:"#1a1a1a",paper:"#2c2c2c"},text:{primary:P.colors.text.primary,secondary:P.colors.text.secondary}},components:{MuiCard:{styleOverrides:{root:{backgroundColor:"none",border:P.borders.subtle,boxShadow:P.shadows.card}}},MuiButton:{styleOverrides:{root:{borderRadius:10,textTransform:"none","@media (hover: none)":{"&:hover":{backgroundColor:"inherit"}}},contained:{backgroundColor:"rgba(124, 179, 66, 0.3)",border:"2px solid rgba(124, 179, 66, 0.6)",backdropFilter:"blur(10px)",boxShadow:"0 6px 20px rgba(124, 179, 66, 0.2)","@media (hover: hover)":{"&:hover":{backgroundColor:"rgba(124, 179, 66, 0.5)",border:"2px solid rgba(124, 179, 66, 0.8)"}},"&:active":{backgroundColor:"rgba(124, 179, 66, 0.5)",transform:"scale(0.98)"}},outlined:{backgroundColor:"rgba(124, 179, 66, 0.2)",border:"2px solid rgba(124, 179, 66, 0.5)",backdropFilter:"blur(10px)","@media (hover: hover)":{"&:hover":{backgroundColor:"rgba(124, 179, 66, 0.3)",border:"2px solid rgba(124, 179, 66, 0.7)"}},"&:active":{backgroundColor:"rgba(124, 179, 66, 0.3)",transform:"scale(0.98)"}},text:{backgroundColor:"rgba(124, 179, 66, 0.15)",backdropFilter:"blur(10px)","@media (hover: hover)":{"&:hover":{backgroundColor:"rgba(124, 179, 66, 0.25)"}},"&:active":{backgroundColor:"rgba(124, 179, 66, 0.25)",transform:"scale(0.98)"}}}},MuiAppBar:{styleOverrides:{root:{backgroundColor:"#1a1a1a",borderBottom:P.borders.primary}}},MuiDrawer:{styleOverrides:{paper:{backgroundColor:"#2c2c2c",borderRight:P.borders.subtle}}},MuiDialog:{styleOverrides:{paper:{backgroundColor:"#2c2c2c",border:P.borders.subtle,boxShadow:P.shadows.elevated}}}},typography:{fontFamily:'"Inter", "Roboto", "Helvetica", "Arial", sans-serif',h1:{fontWeight:700},h2:{fontWeight:700},h3:{fontWeight:600},h4:{fontWeight:600},h5:{fontWeight:600},h6:{fontWeight:600}}},q="ss_guidelines_accepted";function $e({children:o}){const[s,n]=t.useState(null),[r,x]=t.useState(!1),[w,j]=t.useState(!1),[h,p]=t.useState(!0);t.useEffect(()=>{let c;return(async()=>{try{if(!v){p(!1);return}const{data:d}=await v.auth.getSession(),g=d?.session?.user;if(n(g?.id||null),g){const i=`${q}_${g.id}`;localStorage.getItem(i)!=="true"&&x(!0)}}catch(d){console.debug("GuidelinesGate: getSession failed",d)}finally{p(!1)}})(),v&&(c=v.auth.onAuthStateChange((g,i)=>{const l=i?.user;if(n(l?.id||null),l){const f=`${q}_${l.id}`;localStorage.getItem(f)!=="true"&&x(!0)}else x(!1)})?.data?.subscription),()=>c?.unsubscribe?.()},[]);const S=()=>{if(s){const c=`${q}_${s}`;localStorage.setItem(c,"true"),x(!1)}};return h?null:e.jsxs(e.Fragment,{children:[o,e.jsxs(Ce,{open:r,disableEscapeKeyDown:!0,maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ae,{sx:{fontWeight:700},children:"Welcome to StrainSpotter"}),e.jsx(Ie,{children:e.jsxs(z,{spacing:3,sx:{mt:1},children:[e.jsx(L,{severity:"info",children:"Before you start, please review and accept our Community Guidelines."}),e.jsxs(y,{children:[e.jsx(a,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600},children:"Community Guidelines"}),e.jsxs(z,{spacing:2,sx:{mt:2},children:[e.jsxs(y,{children:[e.jsx(a,{variant:"subtitle2",color:"primary.light",sx:{fontWeight:600},children:"âœ“ Be Respectful"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Treat everyone with respect. No harassment, hate speech, or personal attacks."})]}),e.jsxs(y,{children:[e.jsx(a,{variant:"subtitle2",color:"primary.light",sx:{fontWeight:600},children:"âœ“ No Solicitations"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Do not sell, buy, trade, or solicit cannabis or any products. StrainSpotter is for information and community only."})]}),e.jsxs(y,{children:[e.jsx(a,{variant:"subtitle2",color:"primary.light",sx:{fontWeight:600},children:"âœ“ Privacy Matters"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Never share personal contact information (phone numbers, addresses, social media) in public spaces."})]}),e.jsxs(y,{children:[e.jsx(a,{variant:"subtitle2",color:"primary.light",sx:{fontWeight:600},children:"âœ“ Follow Local Laws"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"You are responsible for knowing and following all local, state, and federal laws regarding cannabis."})]}),e.jsxs(y,{children:[e.jsx(a,{variant:"subtitle2",color:"primary.light",sx:{fontWeight:600},children:"âœ“ Report Issues"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Use the report feature if you see content that violates these guidelines."})]})]})]}),e.jsx(Pe,{control:e.jsx(Re,{checked:w,onChange:c=>j(c.target.checked),color:"primary"}),label:e.jsx(a,{variant:"body2",children:"I have read and agree to follow the Community Guidelines"})})]})}),e.jsx(Te,{sx:{p:2},children:e.jsx(E,{onClick:S,variant:"contained",disabled:!w,fullWidth:!0,size:"large",children:"Accept & Continue"})})]})]})}class Ke extends u.Component{constructor(s){super(s),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(s,n){this.setState({error:s,errorInfo:n}),console.error(`
ðŸ”¥ FRONTEND ERROR CAUGHT BY BOUNDARY ðŸ”¥`),console.error("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.error("Time:",new Date().toISOString()),console.error("Error Message:",s?.message||"Unknown error"),console.error("Error Stack:",s?.stack||"No stack trace"),console.error("Error String:",s?.toString()||String(s)),console.error("Component Stack:",n?.componentStack||"No component stack"),console.error("Full Error Object:",s),console.error("Full Error Info:",n),console.error(`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`),this.sendClientError(s,n)}async sendClientError(s,n){try{const{data:{session:r}}=await v.auth.getSession(),x={"Content-Type":"application/json"};r?.access_token&&(x.Authorization=`Bearer ${r.access_token}`),await fetch(`${W}/api/admin/errors/client`,{method:"POST",headers:x,body:JSON.stringify({message:s?.message||s?.toString()||"Unknown error",stack:s?.stack||"No stack trace",componentStack:n?.componentStack||"No component stack",errorString:s?.toString()||String(s),location:window.location.href,currentView:window.location.pathname,platform:navigator?.platform||null,userAgent:navigator?.userAgent||null,fullError:s?{name:s.name,message:s.message,stack:s.stack}:null})})}catch(r){console.warn("[ErrorBoundary] Failed to report client error:",r)}}render(){return this.state.hasError?e.jsx(X,{maxWidth:"md",sx:{py:8},children:e.jsx(K,{sx:{bgcolor:"rgba(211, 47, 47, 0.05)",border:"2px solid #d32f2f44"},children:e.jsxs(H,{children:[e.jsx(a,{variant:"h4",gutterBottom:!0,color:"error",children:"ðŸš¨ Something went wrong"}),e.jsx(L,{severity:"error",sx:{mb:3},children:e.jsx(a,{variant:"body1",fontWeight:"bold",children:this.state.error&&this.state.error.toString()})}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"The application encountered an error. This has been logged to the console."}),e.jsxs(y,{sx:{mb:3},children:[e.jsx(a,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1},children:"Component Stack:"}),e.jsx(y,{component:"pre",sx:{bgcolor:"rgba(0,0,0,0.05)",p:2,borderRadius:1,fontSize:"0.75rem",overflow:"auto",maxHeight:300},children:this.state.errorInfo&&this.state.errorInfo.componentStack})]}),e.jsx(E,{variant:"contained",onClick:()=>window.location.reload(),sx:{mr:2},children:"Reload Page"}),e.jsx(E,{variant:"outlined",onClick:()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.history.back()},children:"Go Back"}),e.jsxs(L,{severity:"info",sx:{mt:3},children:[e.jsx(a,{variant:"caption",fontWeight:"bold",children:"ðŸ’¡ For developers:"}),e.jsx(a,{variant:"caption",display:"block",children:"â€¢ Open browser DevTools (F12) â†’ Console tab for full error details"}),e.jsxs(a,{variant:"caption",display:"block",children:["â€¢ Check backend errors at: ",e.jsx("code",{children:"http://localhost:5173/errors"})]}),e.jsxs(a,{variant:"caption",display:"block",children:["â€¢ PM2 logs: ",e.jsx("code",{children:"pm2 logs strainspotter-backend"})]})]})]})})}):this.props.children}}async function He(o,s={}){try{let n=null;if(v){const{data:{session:r}}=await v.auth.getSession();n=r?.access_token||null}await fetch(`${W}/api/analytics/events`,{method:"POST",headers:{"Content-Type":"application/json",...n?{Authorization:`Bearer ${n}`}:{}},body:JSON.stringify({event_name:o,context:s,platform:navigator?.userAgentData?.platform||navigator?.platform||"unknown",session_id:localStorage.getItem("ss-session-id")})})}catch(n){console.warn("[analytics] Failed to send event",o,n)}}function qe({onBack:o}){const[s,n]=t.useState(""),[r,x]=t.useState(""),[w,j]=t.useState(!1),[h,p]=t.useState(null),[S,c]=t.useState(""),[d,g]=t.useState(!1),[i,l]=t.useState(!1);t.useEffect(()=>{let A,R=!1;return A=setTimeout(async()=>{try{if(!v||!v.auth){p("Supabase client not initialized. Please reload the page.");return}const{data:M,error:U}=await v.auth.getSession();console.log("[PasswordReset] Session check:",M?.session?.user?.email||"none"),M?.session?(g(!0),c("Enter a new password below to complete the reset."),!R&&typeof window<"u"&&setTimeout(()=>{history.replaceState(null,"",window.location.pathname+window.location.search)},500)):(console.error("[PasswordReset] No session found:",U),p("Recovery link is invalid or expired. Please request a new reset email from the Sign In screen."))}catch(M){console.error("[PasswordReset] Session error:",M),p("Unable to validate session. Please request a new reset link.")}},1500),()=>{R=!0,clearTimeout(A)}},[]);async function f(){if(s.length<6){p("Password must be at least 6 characters.");return}if(s!==r){p("Passwords do not match.");return}j(!0),p(null),c(null);try{console.log("[PasswordReset] Updating password");const{data:A,error:R}=await v.auth.updateUser({password:s});if(R)console.error("[PasswordReset] Error:",R),p(R.message);else{if(console.log("[PasswordReset] Password updated successfully"),A?.user?.id)try{await fetch("https://strainspotter.onrender.com/api/users/ensure",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:A.user.id})})}catch(M){console.warn("[PasswordReset] Failed to ensure user record:",M)}c("âœ… Password updated! You are now signed in. Redirecting to home..."),setTimeout(()=>{o?o():window.location.hash="#/"},2e3)}}catch(A){console.error("[PasswordReset] Catch error:",A),p("Failed to update password. Please try again.")}finally{j(!1)}}function C(){o?(o(),setTimeout(()=>{window.location.hash="#/login"},100)):window.location.hash="#/login"}function B(){o?o():window.location.hash="#/"}return e.jsxs(y,{sx:{maxWidth:420,mx:"auto",py:4},children:[e.jsx(E,{onClick:B,size:"small",variant:"contained",sx:{mb:2,bgcolor:"#7CB342",color:"white",textTransform:"none",fontWeight:700,borderRadius:999,"&:hover":{bgcolor:"#689f38"}},children:"â† Home"}),e.jsx(K,{children:e.jsx(H,{children:e.jsxs(z,{spacing:2,children:[e.jsx(a,{variant:"h5",children:"Reset Password"}),S&&e.jsx(L,{severity:"success",children:S}),h&&e.jsx(L,{severity:"error",children:h}),d?e.jsxs(e.Fragment,{children:[e.jsx(G,{label:"New Password",type:i?"text":"password",value:s,onChange:A=>n(A.target.value),fullWidth:!0,autoComplete:"new-password",helperText:e.jsxs(E,{size:"small",onClick:()=>l(!i),sx:{textTransform:"none",p:0,minWidth:0},children:[i?"Hide":"Show"," password"]})}),e.jsx(G,{label:"Confirm Password",type:i?"text":"password",value:r,onChange:A=>x(A.target.value),fullWidth:!0,autoComplete:"new-password"}),e.jsx(E,{variant:"contained",onClick:f,disabled:w,fullWidth:!0,children:w?e.jsx($,{size:20}):"Update Password & Sign In"})]}):e.jsx(e.Fragment,{children:h?e.jsxs(L,{severity:"warning",sx:{mt:1},children:[e.jsx(a,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:"Link Expired"})}),e.jsx(a,{variant:"body2",sx:{mb:2},children:'Password reset links expire after 1 hour. Please request a new one from the Sign In page using the "Forgot Password?" button.'}),e.jsxs(z,{spacing:1,children:[e.jsx(E,{variant:"contained",onClick:C,fullWidth:!0,children:"Go to Sign In & Request New Link"}),e.jsx(E,{variant:"outlined",onClick:B,fullWidth:!0,children:"Back to Home"})]})]}):e.jsx(a,{variant:"body2",children:"Verifying recovery linkâ€¦"})})]})})})]})}const le=20,ce=150,de="strainspotter_is_member",ue="strainspotter_starter_scans_used",he="strainspotter_extra_scan_credits",pe="strainspotter_member_scans_used",ge=[{id:"pack_20",label:"20 scans",credits:20},{id:"pack_50",label:"50 scans",credits:50},{id:"pack_100",label:"100 scans",credits:100}],we=t.createContext(null);function Xe({children:o}){const[s,n]=t.useState(!1),[r,x]=t.useState(!1),[w,j]=t.useState(0),[h,p]=t.useState(0),[S,c]=t.useState(0);t.useEffect(()=>{try{const m=localStorage.getItem(de),T=localStorage.getItem(ue),D=localStorage.getItem(he),J=localStorage.getItem(pe);if(m==="true"&&x(!0),T!=null){const O=parseInt(T,10);!Number.isNaN(O)&&O>=0&&j(O)}if(D!=null){const O=parseInt(D,10);!Number.isNaN(O)&&O>=0&&p(O)}if(J!=null){const O=parseInt(J,10);!Number.isNaN(O)&&O>=0&&c(O)}}catch{}finally{n(!0)}},[]);const d=t.useCallback(m=>{x(m);try{localStorage.setItem(de,m?"true":"false")}catch{}},[]),g=t.useCallback(m=>{j(m);try{localStorage.setItem(ue,String(m))}catch{}},[]),i=t.useCallback(m=>{p(m);try{localStorage.setItem(he,String(m))}catch{}},[]),l=t.useCallback(m=>{c(m);try{localStorage.setItem(pe,String(m))}catch{}},[]),f=Math.max(0,le-w),C=Math.max(0,ce-S),B=r?C+h:f+h,A=t.useCallback(()=>{if(r){if(h>0){const m=Math.max(0,h-1);i(m)}else if(C>0){const m=S+1;l(m)}}else if(h>0){const m=Math.max(0,h-1);i(m)}else if(f>0){const m=w+1;g(m)}},[r,h,f,C,w,S,i,g,l]),R=t.useCallback(()=>{d(!0)},[d]),M=t.useCallback(()=>{d(!1),g(0),i(0),l(0)},[d,g,i,l]),U=t.useCallback(m=>{if(!m||m<=0)return;const T=h+m;i(T)},[h,i]),_=t.useCallback(()=>{console.log("[Membership] requestMembershipPurchase() â€“ hook for native IAP"),R()},[R]),I=t.useCallback(m=>{console.log("[Membership] requestTopupPurchase() â€“ hook for native IAP, packId=",m);const T=ge.find(D=>D.id===m);T&&U(T.credits)},[U]),V={initialized:s,isMember:r,starterUsed:w,starterRemaining:f,memberUsed:S,memberRemaining:C,memberCap:ce,extraCredits:h,totalAvailableScans:B,starterCap:le,markMember:R,resetMembership:M,registerScanConsumed:A,applyTopupCredits:U,requestMembershipPurchase:_,requestTopupPurchase:I,topupPacks:ge};return e.jsx(we.Provider,{value:V,children:o})}function Ze(){const o=t.useContext(we);if(!o)throw new Error("useMembership must be used within MembershipProvider");return o}function Qe({size:o=28,color:s,sx:n,...r}){return e.jsx(y,{component:"svg",width:o,height:o,viewBox:P.leafIcon.viewBox,fill:"none",sx:{color:s||P.colors.primary.main,...n},...r,children:e.jsx("path",{d:P.leafIcon.path,fill:"currentColor"})})}function et(o){switch(o){case"garden":return"Garden";case"reviews":return"Reviews";case"logbook":return"Logbook";default:return"This feature"}}function F({featureKey:o,children:s}){const{isMember:n,totalAvailableScans:r,requestMembershipPurchase:x,requestTopupPurchase:w}=Ze(),j=et(o);return n?s:e.jsxs(y,{sx:{maxWidth:520,mx:"auto",mt:5,p:3,borderRadius:3,border:"1px solid rgba(134, 239, 172, 0.5)",background:"radial-gradient(circle at top, rgba(16, 185, 129, 0.16), rgba(10, 15, 10, 0.96))",boxShadow:"0 0 24px rgba(16, 185, 129, 0.35)",textAlign:"center"},children:[e.jsx(y,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(Qe,{sx:{fontSize:40,color:"#4caf50"}})}),e.jsx(a,{variant:"h5",sx:{mb:1,fontWeight:700},children:"Members Only"}),e.jsxs(a,{variant:"body1",sx:{mb:1.5,color:"rgba(255,255,255,0.9)"},children:[j," unlocks when you join StrainSpotter as a member."]}),e.jsx(a,{variant:"body2",sx:{mb:2.5,color:"rgba(255,255,255,0.7)"},children:"Members get unlimited scans plus full access to Garden, Reviews, and Logbook tools to track grows, stash, and sessions."}),e.jsxs(z,{direction:"row",spacing:1.5,sx:{justifyContent:"center",flexWrap:"wrap"},children:[e.jsx(E,{variant:"contained",size:"large",onClick:x,sx:{borderRadius:999,px:4,py:1.1,textTransform:"none",fontWeight:700,background:"linear-gradient(135deg, #4caf50, #8bc34a)",boxShadow:"0 0 18px rgba(76, 175, 80, 0.6)"},children:"Unlock membership"}),e.jsx(E,{variant:"outlined",size:"large",onClick:()=>w("pack_20"),sx:{borderRadius:999,px:3,py:1.1,textTransform:"none",fontWeight:600,borderColor:"rgba(148, 163, 184, 0.8)",color:"rgba(226, 232, 240, 0.95)"},children:"Just buy scans"})]}),e.jsx(a,{variant:"caption",sx:{display:"block",mt:2,color:"rgba(148,163,184,0.8)"},children:"You can keep scanning with top-ups even without membership, but members always get the best experience."}),r>0&&e.jsx(a,{variant:"caption",sx:{display:"block",mt:.75,color:"rgba(190, 242, 100, 0.9)"},children:"You still have some scan credits left for the scanner."})]})}const k=(...o)=>{typeof window<"u"&&console.log("[DEBUG App.jsx]",new Date().toISOString(),...o)};k("=== APP.JSX STARTING ===");k("About to import React...");k("React imported:",typeof u<"u");k("React version:",u?.version||"unknown");typeof window<"u"&&(k("Setting React globally in App.jsx..."),k("window.React before:",typeof window.React),window.React?k("window.React already exists"):(k("window.React is missing, setting it now"),Object.defineProperty(window,"React",{value:u,writable:!1,configurable:!1,enumerable:!0})),typeof globalThis<"u"&&!globalThis.React&&(k("Setting React on globalThis"),Object.defineProperty(globalThis,"React",{value:u,writable:!1,configurable:!1,enumerable:!0})),k("window.React after:",typeof window.React,window.React?"EXISTS":"MISSING"));k("About to import MUI...");k("React check before MUI import:",typeof u<"u",typeof window?.React<"u");k("MUI imported successfully!");const tt=u.lazy(()=>b(()=>import("./Home-Bd6DTWkh.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]),import.meta.url)),rt=u.lazy(()=>b(()=>import("./ScanPage-BsI9T-Ue.js"),__vite__mapDeps([19,1,2,6,7,8,9]),import.meta.url)),ot=u.lazy(()=>b(()=>import("./HistoryPage-BAItD3Yz.js"),__vite__mapDeps([20,1,2,6,7]),import.meta.url)),nt=u.lazy(()=>b(()=>import("./AnalyticsDashboard-BFPF3lG7.js"),__vite__mapDeps([21,1,2]),import.meta.url)),st=u.lazy(()=>b(()=>import("./ScanHistory-DwPk8_G9.js"),__vite__mapDeps([22,1,2,12,23]),import.meta.url)),at=u.lazy(()=>b(()=>import("./ScanWizard-CpU8GmcI.js").then(o=>o.a),__vite__mapDeps([3,1,2,4,5,6,7,8,9]),import.meta.url)),it=u.lazy(()=>b(()=>import("./ScanResultCard-Cv4hIP62.js").then(o=>o.a),__vite__mapDeps([6,1,2,7]),import.meta.url)),lt=u.lazy(()=>b(()=>import("./FeedbackChat-yIIl37q_.js"),__vite__mapDeps([24,1,2]),import.meta.url)),ct=u.lazy(()=>b(()=>import("./GrowerDirectory-eymkC7u0.js"),__vite__mapDeps([15,1,2,16]),import.meta.url)),dt=u.lazy(()=>b(()=>import("./Groups-C1u7l6VL.js"),__vite__mapDeps([13,1,2,5]),import.meta.url)),ut=u.lazy(()=>b(()=>import("./Seeds-duhzdiwO.js"),__vite__mapDeps([25,1,2,23]),import.meta.url)),ht=u.lazy(()=>b(()=>import("./Dispensaries-DMkEjtsF.js"),__vite__mapDeps([26,1,2,23]),import.meta.url)),pt=u.lazy(()=>b(()=>import("./GrowerRegistration-CDt-qoyN.js"),__vite__mapDeps([16,1,2]),import.meta.url)),gt=u.lazy(()=>b(()=>import("./Help-DKXKUHLt.js"),__vite__mapDeps([27,1,2]),import.meta.url)),ft=u.lazy(()=>b(()=>import("./Friends-BIs2rw0v.js"),__vite__mapDeps([28,1,2]),import.meta.url)),mt=u.lazy(()=>b(()=>import("./StrainBrowser-ChteOdTX.js"),__vite__mapDeps([10,1,2,4,5,11,12,7]),import.meta.url)),xt=u.lazy(()=>b(()=>import("./MembershipJoin-CFe6bnyw.js"),__vite__mapDeps([29,1,2]),import.meta.url)),bt=u.lazy(()=>b(()=>import("./GrowCoach--krqYoX3.js"),__vite__mapDeps([14,1,2,12,5]),import.meta.url)),yt=u.lazy(()=>b(()=>import("./MembershipAdmin-DxZ7O2Lm.js"),__vite__mapDeps([30,1,2]),import.meta.url)),wt=u.lazy(()=>b(()=>import("./PipelineStatus-BPXmHUle.js"),__vite__mapDeps([31,1,2]),import.meta.url)),vt=u.lazy(()=>b(()=>import("./ModerationDashboard-V8QTY4gw.js"),__vite__mapDeps([32,1,2]),import.meta.url)),jt=u.lazy(()=>b(()=>import("./Guidelines-CYr1yumv.js"),__vite__mapDeps([33,1,2]),import.meta.url)),St=u.lazy(()=>b(()=>import("./ErrorViewer-CFoGki2A.js"),__vite__mapDeps([34,1,2]),import.meta.url)),kt=u.lazy(()=>b(()=>import("./EmergencyLogout-DD82G-zk.js"),__vite__mapDeps([35,1,2]),import.meta.url)),_t=u.lazy(()=>b(()=>import("./OnboardingFlow-Cax6Ms8_.js"),__vite__mapDeps([36,1,2]),import.meta.url)),Et=u.lazy(()=>b(()=>import("./FirstRunIntro-BmULqsnv.js"),__vite__mapDeps([37,1,2]),import.meta.url)),Ct=u.lazy(()=>b(()=>import("./JournalPage-CNW9a3ul.js"),__vite__mapDeps([38,1,2,12,11]),import.meta.url));u.lazy(()=>b(()=>import("./FloatingScanButton-rj4cR8P3.js"),__vite__mapDeps([39,1,2]),import.meta.url));const At=u.lazy(()=>b(()=>import("./ScanBalanceIndicator-CJIAwXrV.js"),__vite__mapDeps([40,1,2,9]),import.meta.url)),It=u.lazy(()=>b(()=>import("./BuyScansModal-BsHu5l_I.js"),__vite__mapDeps([17,1,2]),import.meta.url)),Pt=u.lazy(()=>b(()=>import("./AdminStatus-CXdSHwRU.js"),__vite__mapDeps([41,1,2,18]),import.meta.url)),fe=Le(Je);function Rt(){k("=== App() FUNCTION CALLED ===");const[o,s]=t.useState(!1),[n,r]=t.useState("home"),[x,w]=t.useState(null),[j,h]=t.useState(()=>{if(k("Initializing showIntro state..."),typeof window>"u")return!1;try{const d=localStorage.getItem("ss_intro_complete")!=="true";return k("showIntro initial value:",d),d}catch(d){return k("Error reading localStorage:",d),!1}}),[p,S]=t.useState(!1);k("App state initialized - ageVerified:",o,"currentView:",n),t.useEffect(()=>{if(k("App useEffect[0] running..."),localStorage.getItem("strainspotter_age_verified")==="true"&&s(!0),typeof window<"u"&&window.location.hash){const g=window.location.hash;g==="#/emergency-logout"?r("emergency-logout"):/type=recovery/.test(g)?r("reset"):/access_token=/.test(g)&&(r("home"),(async()=>{try{const{data:i}=await v.auth.getSession(),l=i?.session?.user;if(l?.id){const f=l.email||void 0,C=f?f.split("@")[0]:void 0;await fetch(`${W}/api/users/ensure`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:l.id,email:f,username:C})})}}catch(i){console.warn("[onboard] ensure user after magic link failed:",i)}})(),setTimeout(()=>{history.replaceState(null,"",window.location.pathname+window.location.search)},1e3))}},[]),t.useEffect(()=>{const d=g=>{g?.detail&&r(g.detail)};return window.addEventListener("nav:set-view",d),()=>window.removeEventListener("nav:set-view",d)},[]),t.useEffect(()=>{He("app_start",{mode:"production",apiBase:W})},[]);const c=()=>{localStorage.setItem("strainspotter_age_verified","true"),s(!0)};return k("App render - ageVerified:",o),o?(k("Rendering main App UI..."),e.jsxs(re,{theme:fe,children:[e.jsx(oe,{}),e.jsx(Fe,{children:e.jsx(Ue,{children:e.jsxs(Xe,{children:[e.jsxs(Ve,{children:[e.jsx("div",{style:{position:"fixed",inset:0,zIndex:0,width:"100vw",maxWidth:"100vw",overflow:"hidden",backgroundColor:"transparent"}}),e.jsx(Ke,{children:e.jsxs($e,{children:[typeof window<"u"&&!/localhost|127\.0\.0\.1/.test(window.location.host)&&/localhost:5181/.test("https://strainspotter.onrender.com")&&e.jsx("div",{style:{background:"#ff5555",color:"#fff",padding:"6px 12px",textAlign:"center",fontWeight:700},children:"Warning: Frontend is calling localhost API_BASE. Update VITE_API_BASE or config.js."}),e.jsxs("div",{style:{position:"relative",zIndex:10,width:"100%",maxWidth:"100vw",overflowX:"hidden",overflow:n==="home"?"visible":"hidden",left:0,right:0},children:[e.jsx(t.Suspense,{fallback:null,children:e.jsx(_t,{})}),e.jsx(t.Suspense,{fallback:null,children:e.jsx(Et,{open:j,onFinish:()=>{try{localStorage.setItem("ss_intro_complete","true")}catch{}h(!1),r("home")}})}),e.jsx(t.Suspense,{fallback:null,children:e.jsx(At,{onBuyCredits:()=>S(!0)})}),n==="home"&&e.jsx(t.Suspense,{fallback:null,children:e.jsx(tt,{onNavigate:r})}),["scanner","guest-scan","scan"].includes(n)&&e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Opening scannerâ€¦"}),children:e.jsx(rt,{onBack:()=>r("home"),onNavigate:d=>r(d),onScanComplete:d=>{w(d),r("result")}})}),n==="wizard"&&e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading scanner..."}),children:e.jsx(at,{onBack:()=>r("home"),onScanComplete:d=>{w(d),r("result")}})}),n==="result"&&x&&e.jsxs(y,{sx:{display:"flex",flexDirection:"column",height:"100vh",width:"100%",maxWidth:"100vw",overflow:"hidden",overflowX:"hidden",bgcolor:"transparent"},children:[e.jsxs(y,{sx:{flexShrink:0,display:"flex",alignItems:"center",gap:1.5,p:2,borderBottom:"1px solid rgba(255,255,255,0.08)",bgcolor:"rgba(0,0,0,0.3)",backdropFilter:"blur(8px)",zIndex:1},children:[e.jsx(E,{variant:"text",onClick:()=>r("home"),sx:{color:"#fff",minWidth:"auto",px:1},children:"â† Back"}),e.jsx(a,{variant:"h6",sx:{fontWeight:600,color:"#fff",flex:1},children:"Scan Result"})]}),e.jsx(y,{sx:{flex:1,minHeight:0,width:"100%",maxWidth:"100vw",overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",left:0,right:0,position:"relative",paddingBottom:"calc(env(safe-area-inset-bottom) + 80px)",px:2,py:2},children:x?e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading result..."}),children:e.jsx(it,{scan:x,result:x,isGuest:!1})}):e.jsx(y,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"Preparing your resultâ€¦"})})})]}),n==="history"&&e.jsx(F,{featureKey:"logbook",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading history..."}),children:e.jsx(st,{onBack:()=>r("home"),onSelectScan:d=>{w(d),r("result")}})})}),n==="feedback"&&e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading feedback..."}),children:e.jsx(lt,{onBack:()=>r("home")})}),n==="growers"&&e.jsx(F,{featureKey:"garden",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading directory..."}),children:e.jsx(ct,{onNavigate:r,onBack:()=>r("home")})})}),n==="register"&&e.jsx(F,{featureKey:"garden",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading registration..."}),children:e.jsx(pt,{onBack:()=>r("home")})})}),n==="groups"&&e.jsx(F,{featureKey:"garden",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading groups..."}),children:e.jsx(dt,{onNavigate:r,onBack:()=>r("home")})})}),n==="friends"&&e.jsx(F,{featureKey:"garden",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading friends..."}),children:e.jsx(ft,{onBack:()=>r("home")})})}),n==="seeds"&&e.jsx(F,{featureKey:"reviews",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading seeds..."}),children:e.jsx(ut,{onBack:()=>r("home")})})}),n==="dispensaries"&&e.jsx(F,{featureKey:"reviews",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading dispensaries..."}),children:e.jsx(ht,{onBack:()=>r("home")})})}),n==="grow-coach"&&e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading grow coach..."}),children:e.jsx(bt,{onBack:()=>r("home")})}),n==="membership-join"&&e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading membership..."}),children:e.jsx(xt,{onBack:()=>r("home")})}),n==="help"&&e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading help..."}),children:e.jsx(gt,{onNavigate:r,onBack:()=>r("home")})}),n==="login"&&e.jsx(Ye,{onBack:()=>r("home")}),n==="admin-status"&&e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading admin..."}),children:e.jsx(Pt,{onBack:()=>r("home"),onNavigate:r})}),n==="journal"&&e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading journal..."}),children:e.jsx(Ct,{onBack:()=>r("home")})}),n==="strains"&&e.jsx(F,{featureKey:"reviews",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading strains..."}),children:e.jsx(mt,{onNavigate:r})})}),n==="membership-admin"&&e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading admin..."}),children:e.jsx(yt,{onBack:()=>r("home")})}),n==="pipeline"&&e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading pipeline..."}),children:e.jsx(wt,{onBack:()=>r("home")})}),n==="moderation"&&e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading moderation..."}),children:e.jsx(vt,{onBack:()=>r("home")})}),n==="guidelines"&&e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading guidelines..."}),children:e.jsx(jt,{onBack:()=>r("home")})}),n==="reset"&&e.jsx(qe,{onBack:()=>r("home")}),n==="errors"&&e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading errors..."}),children:e.jsx(St,{onBack:()=>r("home")})}),n==="emergency-logout"&&e.jsx(t.Suspense,{fallback:e.jsx("div",{style:{padding:16,color:"#C5E1A5"},children:"Loading..."}),children:e.jsx(kt,{})}),n==="analytics"&&e.jsx(t.Suspense,{fallback:null,children:e.jsx(nt,{onBack:()=>r("home")})}),n==="history"&&e.jsx(t.Suspense,{fallback:null,children:e.jsx(ot,{onBack:()=>r("home")})}),e.jsx(t.Suspense,{fallback:null})]})]})})]}),e.jsx(t.Suspense,{fallback:null,children:e.jsx(It,{open:p,onClose:()=>S(!1)})})]})})})]})):(k("Rendering AgeGate..."),e.jsxs(re,{theme:fe,children:[e.jsx(oe,{}),e.jsx(Ge,{onVerify:c})]}))}const Mt=Object.freeze(Object.defineProperty({__proto__:null,default:Rt},Symbol.toStringTag,{value:"Module"}));export{Rt as A,Qe as C,Ke as E,Ot as F,me as S,W as a,Ze as b,zt as c,Mt as d,Y as i,He as l,v as s,Ne as u};
