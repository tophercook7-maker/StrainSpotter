import{r as d,j as e,B,i as M,f as F,h as L,S as g,T as W,m as i,ah as b,a0 as n,s as p,aP as f,Z as _,t as q,A as O,as as H}from"./react-vendor-CxfKVgr3.js";import{s as U,a as z}from"./App-JmJcCWdD.js";import"./vendor-DCH4KwNm.js";function K({onBack:w}){const[l,D]=d.useState("non-certified"),[t,m]=d.useState({growerId:"",farmName:"",city:"",state:"",specialties:"",bio:"",experienceYears:3,licenseStatus:"not_applicable",acceptsMessages:!0,optInDirectory:!0,phone:"",address:"",contactRiskAcknowledged:!1,moderatorOptIn:!1,moderatorMotivation:"",moderatorAvailability:"",moderatorExperience:"",moderatorNotes:""}),[y,j]=d.useState(!1),[v,k]=d.useState(null),[C,I]=d.useState(""),s=o=>r=>m({...t,[o]:r.target.value}),x=o=>r=>m({...t,[o]:r.target.checked}),P=d.useMemo(()=>[{value:"licensed",label:"Licensed"},{value:"unlicensed",label:"Unlicensed"},{value:"not_applicable",label:"Not Applicable"}],[]),G=()=>m({growerId:"",farmName:"",city:"",state:"",specialties:"",bio:"",experienceYears:3,licenseStatus:l==="certified"?"licensed":"not_applicable",acceptsMessages:!0,optInDirectory:!0,phone:"",address:"",contactRiskAcknowledged:!1,moderatorOptIn:!1,moderatorMotivation:"",moderatorAvailability:"",moderatorExperience:"",moderatorNotes:""});async function T(){j(!0),k(null);try{const{data:o,error:r}=await U.auth.getSession();if(r)throw r;const a=o?.session?.user?.id;if(!a)throw new Error("Please sign in before registering as a grower.");const c=l==="certified",u={userId:a,isGrower:!0,licenseStatus:c?"licensed":t.licenseStatus,experienceYears:Number(t.experienceYears)||0,bio:t.bio,specialties:t.specialties,city:t.city,state:t.state,country:"USA",farmName:t.farmName,acceptsMessages:t.acceptsMessages,optInDirectory:t.optInDirectory,phone:t.phone||null,address:t.address||null,contactRiskAcknowledged:t.contactRiskAcknowledged,certified:c,moderatorOptIn:c&&t.moderatorOptIn};if((u.phone||u.address)&&!u.contactRiskAcknowledged)throw new Error("Please acknowledge the risks of sharing contact information.");if(c&&!t.growerId)throw new Error("Certified growers must provide their certification or license ID.");let S=null;if(c&&t.moderatorOptIn){const h=t.moderatorMotivation.trim(),E=t.moderatorAvailability.trim(),N=t.moderatorExperience.trim(),R=t.moderatorNotes.trim();if(!h||!E)throw new Error("Please tell us why you would be a great moderator and when you are available.");S={motivation:h,availability:E,...N?{experience:N}:{},...R?{notes:R}:{}}}const Y={...u,growerId:c?t.growerId:null,moderatorApplication:S},A=await fetch(`${z}/api/growers/profile/setup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Y)});if(!A.ok){const h=await A.json().catch(()=>({}));throw new Error(h.error||"Failed to register grower profile.")}I("Registration submitted!"),G()}catch(o){k(o.message)}finally{j(!1)}}return e.jsxs(B,{sx:{maxWidth:720,mx:"auto",py:4},children:[w&&e.jsx(M,{onClick:w,size:"small",variant:"contained",sx:{bgcolor:"white",color:"black",textTransform:"none",fontWeight:700,borderRadius:999,mb:1,"&:hover":{bgcolor:"grey.100"}},children:"Home"}),e.jsx(F,{children:e.jsx(L,{children:e.jsxs(g,{spacing:2,children:[e.jsx(W,{variant:"h5",children:"Grower Registration"}),e.jsxs(i,{select:!0,label:"Registration Type",value:l,onChange:o=>{const r=o.target.value;D(r),m(a=>({...a,licenseStatus:r==="certified"||a.licenseStatus==="licensed"?"licensed":"not_applicable",moderatorOptIn:r==="certified"?a.moderatorOptIn:!1,moderatorMotivation:r==="certified"?a.moderatorMotivation:"",moderatorAvailability:r==="certified"?a.moderatorAvailability:"",moderatorExperience:r==="certified"?a.moderatorExperience:"",moderatorNotes:r==="certified"?a.moderatorNotes:""}))},children:[e.jsx(b,{value:"certified",children:"Certified Grower"}),e.jsx(b,{value:"non-certified",children:"Non-Certified Grower"})]}),l==="certified"&&e.jsx(i,{label:"Grower ID",value:t.growerId,onChange:s("growerId"),required:!0}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(i,{label:"Farm / Brand Name",value:t.farmName,onChange:s("farmName"),fullWidth:!0})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(i,{label:"City",value:t.city,onChange:s("city"),fullWidth:!0})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(i,{label:"State",value:t.state,onChange:s("state"),fullWidth:!0})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(i,{label:"Years of Experience",type:"number",inputProps:{min:0},value:t.experienceYears,onChange:s("experienceYears"),fullWidth:!0})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(i,{label:"Specialties (comma-separated)",value:t.specialties,onChange:s("specialties"),fullWidth:!0})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(i,{label:"Bio",value:t.bio,onChange:s("bio"),fullWidth:!0,multiline:!0,minRows:3})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(i,{select:!0,label:"License Status",value:t.licenseStatus,onChange:s("licenseStatus"),fullWidth:!0,disabled:l==="certified",children:P.map(o=>e.jsx(b,{value:o.value,children:o.label},o.value))})}),e.jsx(n,{item:!0,xs:12,sm:6,sx:{display:"flex",alignItems:"center"},children:e.jsx(p,{control:e.jsx(f,{checked:t.acceptsMessages,onChange:x("acceptsMessages")}),label:"Accept direct messages from members"})})]}),e.jsx(_,{}),e.jsx(p,{control:e.jsx(f,{checked:t.optInDirectory,onChange:x("optInDirectory")}),label:"List me in the public grower directory"}),e.jsx(W,{variant:"caption",color:"text.secondary",children:"New growers are welcome — we highlight certified growers separately and sort the list by experience so members can find the right fit."}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(i,{label:"Public Phone (optional)",value:t.phone,onChange:s("phone"),fullWidth:!0})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(i,{label:"Public Address (optional)",value:t.address,onChange:s("address"),fullWidth:!0})})]}),(t.phone||t.address)&&e.jsx(p,{control:e.jsx(q,{checked:t.contactRiskAcknowledged,onChange:x("contactRiskAcknowledged")}),label:"I understand the risks of sharing my contact information publicly."}),l==="certified"&&e.jsx(p,{control:e.jsx(f,{checked:t.moderatorOptIn,onChange:o=>{const r=o.target.checked;m(a=>({...a,moderatorOptIn:r,moderatorMotivation:r?a.moderatorMotivation:"",moderatorAvailability:r?a.moderatorAvailability:"",moderatorExperience:r?a.moderatorExperience:"",moderatorNotes:r?a.moderatorNotes:""}))}}),label:"I'll earn that free membership by helping moderate the community (you gotta earn it!)"}),l==="certified"&&t.moderatorOptIn&&e.jsxs(g,{spacing:2,sx:{p:2,bgcolor:"rgba(124,179,66,0.08)",borderRadius:2,border:"1px solid rgba(124,179,66,0.3)"},children:[e.jsx(O,{severity:"info",sx:{bgcolor:"rgba(255,255,255,0.7)"},children:"Certified moderators help keep conversations safe and on-topic. Share a quick note about how you can contribute so we can activate your complimentary membership."}),e.jsx(i,{label:"Why you'd be a great moderator",value:t.moderatorMotivation,onChange:s("moderatorMotivation"),fullWidth:!0,multiline:!0,minRows:2,required:!0}),e.jsx(i,{label:"Weekly availability (hours / time windows)",value:t.moderatorAvailability,onChange:s("moderatorAvailability"),fullWidth:!0,multiline:!0,minRows:2,required:!0}),e.jsx(i,{label:"Experience moderating or supporting communities",value:t.moderatorExperience,onChange:s("moderatorExperience"),fullWidth:!0,multiline:!0,minRows:2}),e.jsx(i,{label:"Anything else we should know?",value:t.moderatorNotes,onChange:s("moderatorNotes"),fullWidth:!0,multiline:!0,minRows:2})]}),v&&e.jsx(O,{severity:"error",children:v}),e.jsx(g,{direction:"row",spacing:2,children:e.jsx(M,{variant:"contained",onClick:T,disabled:y,children:y?"Submitting…":"Submit"})})]})})}),e.jsx(H,{open:!!C,autoHideDuration:2500,onClose:()=>I(""),message:C})]})}export{K as default};
