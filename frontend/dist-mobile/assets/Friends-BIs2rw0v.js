import{r as t,j as r,B as N,C as O,i,T as o,A as P,f as z,h as B,S as E,m as U,k as J,l as m,n as H,aI as j,aJ as f,aL as p,M as y,aK as g,H as W}from"./react-vendor-CxfKVgr3.js";import{a as c}from"./App-JmJcCWdD.js";import"./vendor-DCH4KwNm.js";function G({userId:d="demo-user",onBack:w}){const[l,_]=t.useState(0),[h,v]=t.useState([]),[u,b]=t.useState([]),[x,S]=t.useState([]),[$,C]=t.useState(!0),[F,n]=t.useState(null),[k,T]=t.useState(""),a=t.useCallback(async()=>{C(!0),n(null);try{const e=await fetch(`${c}/api/friends?user_id=${d}`);if(!e.ok){const D=await e.json().catch(()=>({}));throw new Error(D.error||"Failed to load friends")}const s=await e.json();v(s.friends||[]),b(s.sent||[]),S(s.received||[]),n(null)}catch(e){console.error("Friends fetch error:",e),n(e.message),v([]),b([]),S([])}finally{C(!1)}},[d]);t.useEffect(()=>{a()},[a]);const q=async()=>{if(k.trim())try{const e=await fetch(`${c}/api/friends/request`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:d,friend_id:"friend-user-id"})});if(!e.ok){const s=await e.json();throw new Error(s.error||"Failed to send request")}T(""),a()}catch(e){n(e.message)}},R=async e=>{try{if(!(await fetch(`${c}/api/friends/accept`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({friendship_id:e})})).ok)throw new Error("Failed to accept");a()}catch(s){n(s.message)}},L=async e=>{try{if(!(await fetch(`${c}/api/friends/reject`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({friendship_id:e})})).ok)throw new Error("Failed to reject");a()}catch(s){n(s.message)}},A=async e=>{try{if(!(await fetch(`${c}/api/friends/${e}`,{method:"DELETE"})).ok)throw new Error("Failed to remove");a()}catch(s){n(s.message)}};return r.jsx(N,{sx:{minHeight:"100vh"},children:r.jsxs(O,{maxWidth:"md",sx:{py:4},children:[w&&r.jsx(i,{onClick:w,size:"small",variant:"contained",sx:{bgcolor:"white",color:"black",textTransform:"none",fontWeight:700,borderRadius:999,mb:1,"&:hover":{bgcolor:"grey.100"}},children:"Home"}),r.jsx(o,{variant:"h4",gutterBottom:!0,children:"Friends"}),F&&r.jsx(P,{severity:"error",sx:{mb:2},children:F}),r.jsx(z,{sx:{mb:3},children:r.jsxs(B,{children:[r.jsx(o,{variant:"h6",gutterBottom:!0,children:"Add Friend"}),r.jsxs(E,{direction:"row",spacing:2,children:[r.jsx(U,{placeholder:"Enter username",value:k,onChange:e=>T(e.target.value),fullWidth:!0}),r.jsx(i,{variant:"contained",onClick:q,children:"Send Request"})]})]})}),r.jsxs(J,{value:l,onChange:(e,s)=>_(s),sx:{mb:2},children:[r.jsx(m,{label:`Friends (${h.length})`}),r.jsx(m,{label:`Requests (${x.length})`}),r.jsx(m,{label:`Sent (${u.length})`})]}),$?r.jsx(H,{}):r.jsxs(r.Fragment,{children:[l===0&&r.jsx(j,{children:h.length===0?r.jsx(o,{variant:"body2",color:"text.secondary",children:"No friends yet"}):h.map(e=>{const s=e.user_id===d?e.friend:e.users;return r.jsxs(f,{children:[r.jsx(p,{children:r.jsx(y,{src:s?.avatar_url,children:s?.username?.[0]||"?"})}),r.jsx(g,{primary:s?.username||"Unknown",secondary:`Friends since ${new Date(e.accepted_at).toLocaleDateString()}`}),r.jsx(i,{size:"small",color:"error",onClick:()=>A(e.id),children:"Remove"})]},e.id)})}),l===1&&r.jsx(j,{children:x.length===0?r.jsx(o,{variant:"body2",color:"text.secondary",children:"No pending requests"}):x.map(e=>r.jsxs(f,{children:[r.jsx(p,{children:r.jsx(y,{src:e.users?.avatar_url,children:e.users?.username?.[0]||"?"})}),r.jsx(g,{primary:e.users?.username||"Unknown",secondary:`Requested ${new Date(e.requested_at).toLocaleDateString()}`}),r.jsxs(E,{direction:"row",spacing:1,children:[r.jsx(i,{size:"small",variant:"contained",onClick:()=>R(e.id),children:"Accept"}),r.jsx(i,{size:"small",variant:"outlined",onClick:()=>L(e.id),children:"Reject"})]})]},e.id))}),l===2&&r.jsx(j,{children:u.length===0?r.jsx(o,{variant:"body2",color:"text.secondary",children:"No sent requests"}):u.map(e=>r.jsxs(f,{children:[r.jsx(p,{children:r.jsx(y,{src:e.friend?.avatar_url,children:e.friend?.username?.[0]||"?"})}),r.jsx(g,{primary:e.friend?.username||"Unknown",secondary:`Sent ${new Date(e.requested_at).toLocaleDateString()}`}),r.jsx(W,{label:"Pending",size:"small"})]},e.id))})]})]})})}export{G as default};
