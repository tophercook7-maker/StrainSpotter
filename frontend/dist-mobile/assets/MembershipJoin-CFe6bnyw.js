import{r as s,j as e,C as D,i as o,B as v,T as r,av as B,f as w,h as S,A as h,S as x,H as G,D as N,p as z,q as H,m as c,u as J}from"./react-vendor-CxfKVgr3.js";import{a as p,s as d}from"./App-JmJcCWdD.js";import"./vendor-DCH4KwNm.js";function ge(){const[g,Y]=s.useState({count:null,lastUpdated:null});s.useEffect(()=>{(async()=>{try{const[t,a]=await Promise.all([fetch(`${p}/api/strains/count`),fetch(`${p}/api/strains/last-updated`)]),i=await t.json(),y=await a.json();Y({count:i.count,lastUpdated:y.lastUpdated?new Date(y.lastUpdated):null})}catch{}})()},[]);const[K,m]=s.useState(!1),[C,Q]=s.useState(""),[k,V]=s.useState(""),[F,l]=s.useState(null),[R,W]=s.useState(null),[X,Z]=s.useState(null),[ee,te]=s.useState(!0),[A,$]=s.useState(!1),[se,b]=s.useState(!1),[n,u]=s.useState({email:"",full_name:"",phone:"",message:""}),[U,f]=s.useState(null),[I,P]=s.useState(null),[L,re]=s.useState([]),[ae,oe]=s.useState(null),[ne,ie]=s.useState(!0),[T,le]=s.useState(null),M=s.useCallback(()=>{let t=localStorage.getItem("ss-session-id");return t||(t=`session-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("ss-session-id",t)),t},[]),O=s.useCallback(async()=>{try{const t=await fetch(`${p}/api/membership/status`,{headers:{"x-session-id":M()}});t.ok&&Z(await t.json())}catch(t){console.error("Failed to load status:",t)}finally{te(!1)}},[M]);s.useEffect(()=>{O()},[O]),s.useEffect(()=>{(async()=>{try{const t=await fetch(`${p}/api/credits/packages`),a=await t.json();if(!t.ok||!a.success)throw new Error(a.error||"Unable to load pricing");re(Array.isArray(a.packages)?a.packages:[]),oe(a.role||null)}catch(t){console.error("Pricing load error:",t),le(t.message||"Failed to load pricing")}finally{ie(!1)}})()},[]);const ce=async()=>{if(l(null),!C||!k){l("Please enter both email and password.");return}try{const{error:t}=await d.auth.signInWithPassword({email:C,password:k});if(t){l(t.message);return}m(!1)}catch(t){console.error("Supabase login failed:",t),l("Login failed. Please try again.")}};if(s.useEffect(()=>{let t;return(async()=>{const i=await d.auth.getSession?.();i?.data?.session?.user&&W(i.data.session.user)})(),t=d.auth.onAuthStateChange((i,y)=>{W(y?.user||null)}),()=>{t?.data?.unsubscribe&&t.data.unsubscribe()}},[]),R)return e.jsxs(D,{maxWidth:"md",sx:{py:4},children:[e.jsx(o,{onClick:()=>window.location.href="/",variant:"contained",sx:{position:"absolute",top:16,left:16,bgcolor:"#388e3c",color:"white",fontWeight:700,borderRadius:999,boxShadow:"0 2px 8px 0 rgba(46,125,50,0.18)",zIndex:10,textTransform:"none",px:3,py:1},children:"Home"}),e.jsxs(v,{sx:{mt:8,textAlign:"center"},children:[e.jsxs(r,{variant:"h4",sx:{fontWeight:700,color:"#2e7d32",mb:2},children:["Welcome, ",R.email,"!"]}),e.jsx(r,{variant:"body1",sx:{color:"#388e3c",mb:2},children:"You are now logged in and have full access to all features."}),e.jsx(o,{variant:"contained",color:"error",sx:{borderRadius:999,px:4,py:1,fontWeight:600},onClick:async()=>{await d.auth.signOut(),W(null)},children:"Logout"})]})]});const de=async t=>{t.preventDefault(),f(null),P(null),$(!0);try{const a=await fetch(`${p}/api/membership/apply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),i=await a.json();if(!a.ok){f(i.error||"Application failed");return}P("Application submitted! We will review and be in touch via email within 24-48 hours. Thank you!"),b(!1),u({email:"",full_name:"",phone:"",message:""})}catch(a){console.error("Membership apply error:",a),f("Network error. Please check your connection and try again.")}finally{$(!1)}};if(ee)return e.jsx(D,{maxWidth:"md",sx:{py:4},children:e.jsx(B,{})});const _=L.find(t=>t.type==="app_purchase"),j=L.find(t=>t.type==="membership"),q=L.filter(t=>t.type==="top_up"),E=t=>t?`$${t.effectivePrice.toFixed(2)}`:"",ue=t=>{if(!t?.credits)return"";const a=t.effectivePrice/t.credits;return a<1?`${(a*100).toFixed(1)}¢ per scan`:`$${a.toFixed(2)} per scan`};return e.jsxs(D,{maxWidth:"md",sx:{py:4,position:"relative"},children:[e.jsx(o,{onClick:()=>window.location.href="/",variant:"contained",sx:{position:"absolute",top:16,left:16,bgcolor:"#388e3c",color:"white",fontWeight:700,borderRadius:999,boxShadow:"0 2px 8px 0 rgba(46,125,50,0.18)",zIndex:10,textTransform:"none",px:3,py:1},children:"Home"}),e.jsxs(v,{sx:{mb:2,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",opacity:.95},children:[g.count!==null&&e.jsxs(r,{variant:"body2",sx:{fontWeight:600,color:"#388e3c",textAlign:"center",fontSize:"1rem",mb:.5},children:["Over ",e.jsx("span",{style:{fontWeight:800},children:g.count.toLocaleString()})," strains in our database"]}),g.lastUpdated&&e.jsxs(r,{variant:"caption",sx:{color:"#388e3c",textAlign:"center"},children:["Updated ",g.lastUpdated.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})]})]}),e.jsx(r,{variant:"h4",sx:{mb:3,fontWeight:700,color:"#2e7d32",textShadow:"0 2px 12px rgba(46,125,50,0.2)"},children:"Welcome to StrainSpotter Membership"}),e.jsx(w,{sx:{mb:3,borderRadius:3,background:"rgba(255,255,255,0.08)",border:"1px solid rgba(56,142,60,0.18)",backdropFilter:"blur(8px)"},children:e.jsxs(S,{children:[e.jsx(r,{variant:"h6",sx:{color:"#388e3c",mb:1},children:"Simple Pricing"}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"One-time unlock for the first 20 scans, then $4.99/month for 200 scans + optional top-ups (50 / 200 / 500)."}),ne?e.jsx(B,{}):T?e.jsx(h,{severity:"warning",children:T}):e.jsxs(e.Fragment,{children:[e.jsxs(x,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2},children:[_&&e.jsx(w,{variant:"outlined",sx:{flex:1,borderColor:"rgba(56,142,60,0.25)"},children:e.jsxs(S,{children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Step 1"}),e.jsx(r,{variant:"h6",sx:{color:"#2e7d32",mb:1},children:"Unlock the App"}),e.jsx(r,{variant:"h4",sx:{fontWeight:700,color:"#1b5e20"},children:E(_)}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"20 scans included. Unlock Groups, Grow Coach, and The Garden forever."})]})}),j&&e.jsx(w,{variant:"outlined",sx:{flex:1,borderColor:"rgba(56,142,60,0.25)"},children:e.jsxs(S,{children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Step 2"}),e.jsx(r,{variant:"h6",sx:{color:"#2e7d32",mb:1},children:"Monthly Member"}),e.jsxs(r,{variant:"h4",sx:{fontWeight:700,color:"#1b5e20"},children:[E(j),e.jsx(r,{component:"span",variant:"body2",color:"text.secondary",children:"/month"})]}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"200 AI scans each month + priority support. Cancel anytime."}),ae==="moderator"&&j.moderatorDiscount&&e.jsx(G,{label:`${j.moderatorDiscount.percent}% moderator discount`,size:"small",color:"success",sx:{mt:1}})]})})]}),q.length>0&&e.jsxs(x,{spacing:1,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Need more scans?"}),e.jsx(x,{direction:{xs:"column",sm:"row"},spacing:1,children:q.map(t=>e.jsx(G,{label:`${t.credits} scans • ${E(t)} • ${ue(t)}`,variant:"outlined",sx:{borderColor:"rgba(56,142,60,0.4)"}},t.id))})]})]})]})}),X?.isMember?e.jsx(v,{sx:{mt:3,p:4,borderRadius:4,background:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(46,125,50,0.25)",backdropFilter:"blur(12px)",border:"1px solid rgba(56,142,60,0.25)",color:"#2e7d32",fontWeight:600},children:"You're an active member! Enjoy unlimited access to all features."}):e.jsx(w,{sx:{mb:3,borderRadius:4,background:"rgba(255,255,255,0.10)",boxShadow:"0 8px 32px 0 rgba(46,125,50,0.18)",backdropFilter:"blur(10px)",border:"1px solid rgba(56,142,60,0.18)",color:"#388e3c"},children:e.jsxs(S,{children:[e.jsx(r,{variant:"h6",sx:{mb:2,color:"#388e3c"},children:"Basic Access"}),e.jsxs(v,{sx:{background:"rgba(255,255,255,0.10)",borderRadius:2,p:2,color:"#388e3c",fontWeight:500,boxShadow:"0 2px 8px 0 rgba(46,125,50,0.10)",border:"1px solid rgba(56,142,60,0.10)"},children:["You have access to the scanner and results.",e.jsx("br",{}),e.jsx("strong",{children:"Unlock Full Access:"})," ",e.jsx("br",{}),e.jsx("ul",{style:{margin:"8px 0 0 16px",color:"#388e3c"},children:e.jsx("li",{children:"Sign up for membership to enjoy exclusive strain data, grow guides, chat/groups, dispensary/grower access, and more."})}),e.jsx(o,{variant:"contained",sx:{mt:2,bgcolor:"#388e3c",color:"white",fontWeight:700,borderRadius:2,boxShadow:"0 2px 8px 0 rgba(46,125,50,0.18)"},onClick:()=>b(!0),children:"Join Now"}),e.jsx(o,{variant:"outlined",sx:{mt:2,ml:2,borderRadius:2,fontWeight:700},onClick:()=>m(!0),children:"Login to Unlock Full Access"})]})]})}),e.jsxs(N,{open:K,onClose:()=>m(!1),children:[e.jsx(z,{children:"Login"}),e.jsx(H,{children:e.jsxs(x,{spacing:2,sx:{pt:1},children:[e.jsx(o,{variant:"contained",color:"primary",sx:{borderRadius:999,px:4,py:1,fontWeight:600},onClick:async()=>{const{error:t}=await d.auth.signInWithOAuth({provider:"google"});t&&l("Google login failed: "+t.message)},children:"Login with Google"}),e.jsx(o,{variant:"contained",color:"secondary",sx:{borderRadius:999,px:4,py:1,fontWeight:600},onClick:async()=>{const{error:t}=await d.auth.signInWithOAuth({provider:"apple"});t&&l("Apple login failed: "+t.message)},children:"Login with Apple"}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),ce()},children:[e.jsx(c,{label:"Email",type:"email",value:C,onChange:t=>Q(t.target.value),fullWidth:!0,autoFocus:!0,sx:{mt:1},required:!0}),e.jsx(c,{label:"Password",type:"password",value:k,onChange:t=>V(t.target.value),fullWidth:!0,sx:{mt:2},required:!0}),e.jsx(o,{type:"submit",variant:"outlined",sx:{mt:2,borderRadius:999,px:3,py:1,fontWeight:600},children:"Login with Email"})]}),F&&e.jsx(h,{severity:"error",sx:{mt:2},children:F})]})}),e.jsx(J,{children:e.jsx(o,{onClick:()=>m(!1),children:"Cancel"})})]}),U&&e.jsx(h,{severity:"error",sx:{mt:2},onClose:()=>f(null),children:U}),I&&e.jsx(h,{severity:"success",sx:{mt:2},onClose:()=>P(null),children:I}),e.jsx(N,{open:se,onClose:()=>b(!1),maxWidth:"sm",fullWidth:!0,children:e.jsxs("form",{onSubmit:de,children:[e.jsx(z,{children:"Membership Application"}),e.jsx(H,{children:e.jsxs(x,{spacing:2,sx:{pt:1},children:[e.jsx(c,{label:"Email",type:"email",required:!0,fullWidth:!0,value:n.email,onChange:t=>u({...n,email:t.target.value})}),e.jsx(c,{label:"Full Name",required:!0,fullWidth:!0,value:n.full_name,onChange:t=>u({...n,full_name:t.target.value})}),e.jsx(c,{label:"Phone (optional)",fullWidth:!0,value:n.phone,onChange:t=>u({...n,phone:t.target.value})}),e.jsx(c,{label:"Message (optional)",multiline:!0,rows:3,fullWidth:!0,value:n.message,onChange:t=>u({...n,message:t.target.value}),placeholder:"Tell us why you want to join..."}),e.jsx(h,{severity:"info",children:"After submitting, our team will review your application and contact you with payment instructions."})]})}),e.jsxs(J,{children:[e.jsx(o,{onClick:()=>b(!1),disabled:A,children:"Cancel"}),e.jsx(o,{type:"submit",variant:"contained",disabled:A,children:A?"Submitting...":"Submit Application"})]})]})})]})}export{ge as default};
