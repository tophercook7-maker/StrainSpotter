import{r as l,j as s,B as S,n as v,C,A,i as d,S as t,bs as z,T as r,a9 as W,a0 as h,f as x,h as m,H as e,bt as P,bu as R,Z as F}from"./react-vendor-CxfKVgr3.js";import{u as L,a as j,s as $}from"./App-JmJcCWdD.js";import{i as T}from"./roles-BG0liTN4.js";import"./vendor-DCH4KwNm.js";async function _(){if(!$)return{};const{data:{session:u}}=await $.auth.getSession(),o=u?.access_token;return o?{Authorization:`Bearer ${o}`}:{}}function K({onBack:u,onNavigate:o}){const{user:f,loading:p}=L(),[i,k]=l.useState(null),[g,w]=l.useState(null),[a,B]=l.useState(null),[y,H]=l.useState(null),b=l.useMemo(()=>T(f?.email),[f]);return l.useEffect(()=>{p||!b||(async()=>{try{const n=await _(),[I,E,M]=await Promise.all([fetch(`${j}/health`).then(c=>c.json()),fetch(`${j}/api/health`).then(c=>c.json()),fetch(`${j}/api/analytics/events/summary`,{headers:n}).then(c=>c.json())]);k(I),w(E),B(M)}catch(n){console.error("[AdminStatus] Failed to load status:",n),H(n.message||"Unable to load status page.")}})()},[p,b]),p?s.jsx(S,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(v,{})}):b?s.jsx(S,{sx:{minHeight:"100vh",py:4},children:s.jsxs(C,{maxWidth:"lg",children:[s.jsxs(t,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:3},children:[s.jsxs(t,{direction:"row",spacing:1,alignItems:"center",children:[s.jsx(z,{color:"success"}),s.jsx(r,{variant:"h5",fontWeight:800,children:"Status & Debug"})]}),s.jsxs(t,{direction:"row",spacing:1,children:[s.jsx(d,{variant:"outlined",onClick:u,children:"Back"}),s.jsx(d,{variant:"contained",startIcon:s.jsx(W,{}),onClick:()=>o?.("errors"),children:"Admin Errors"})]})]}),y&&s.jsx(A,{severity:"error",sx:{mb:3},children:y}),s.jsxs(h,{container:!0,spacing:2,sx:{mb:3},children:[s.jsx(h,{item:!0,xs:12,md:4,children:s.jsx(x,{children:s.jsxs(m,{children:[s.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Environment"}),s.jsxs(t,{spacing:1,children:[s.jsx(e,{label:"Mode: production",size:"small"}),s.jsx(e,{label:`API Base: ${j}`,size:"small",icon:s.jsx(P,{})}),g?.rls?.mode&&s.jsx(e,{label:`RLS Mode: ${g.rls.mode}`,size:"small",color:g.rls.mode==="prod"?"success":"default"})]})]})})}),s.jsx(h,{item:!0,xs:12,md:4,children:s.jsx(x,{children:s.jsxs(m,{children:[s.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Backend Health"}),s.jsxs(t,{spacing:1,children:[s.jsx(e,{label:`Supabase: ${i?.supabaseConfigured?"OK":"Missing"}`,color:i?.supabaseConfigured?"success":"error",size:"small"}),s.jsx(e,{label:`Vision: ${i?.googleVisionConfigured?i?.visionMethod:"Missing"}`,color:i?.googleVisionConfigured?"success":"warning",size:"small"}),s.jsx(e,{label:`Bucket: ${i?.bucketExists?"Found":"Missing"}`,color:i?.bucketExists?"success":"warning",size:"small"})]})]})})}),s.jsx(h,{item:!0,xs:12,md:4,children:s.jsx(x,{children:s.jsxs(m,{children:[s.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Links"}),s.jsxs(t,{spacing:1,children:[s.jsx(d,{variant:"outlined",onClick:()=>o?.("moderation"),children:"Moderation Dashboard"}),s.jsx(d,{variant:"outlined",onClick:()=>o?.("membership-admin"),children:"Membership Admin"})]})]})})})]}),s.jsx(x,{sx:{mb:3},children:s.jsxs(m,{children:[s.jsxs(t,{direction:"row",spacing:1,alignItems:"center",sx:{mb:2},children:[s.jsx(R,{color:"primary"}),s.jsx(r,{variant:"subtitle1",fontWeight:700,children:"Last 7 days of activity"})]}),a?s.jsxs(s.Fragment,{children:[s.jsxs(t,{direction:"row",spacing:2,sx:{mb:2,flexWrap:"wrap"},children:[s.jsx(e,{label:`Scans started: ${a.scanStats?.started??0}`}),s.jsx(e,{label:`Scans completed: ${a.scanStats?.completed??0}`}),s.jsx(e,{label:`Success rate: ${a.scanStats?.successRate!=null?`${a.scanStats.successRate.toFixed(1)}%`:"n/a"}`}),s.jsx(e,{label:`Journal entries: ${a.totals?.journal_entry_created??0}`})]}),s.jsx(F,{sx:{my:2}}),s.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Top matched strains"}),a.topStrains?.length?s.jsx(t,{direction:"row",spacing:1,flexWrap:"wrap",children:a.topStrains.map(n=>s.jsx(e,{label:`${n.name} (${n.count})`,color:"success",variant:"outlined"},n.slug))}):s.jsx(r,{variant:"body2",color:"text.secondary",children:"No scan activity logged yet."})]}):s.jsx(v,{size:24})]})})]})}):s.jsxs(C,{maxWidth:"sm",sx:{py:6},children:[s.jsx(A,{severity:"error",sx:{mb:2},children:"Admin-only page. Please sign in with an approved admin account."}),s.jsx(d,{variant:"contained",onClick:u,children:"Back"})]})}export{K as default};
